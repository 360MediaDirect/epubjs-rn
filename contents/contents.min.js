(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t(require('xmldom')):'function'==typeof define&&define.amd?define(['xmldom'],t):'object'==typeof exports?exports.EPUBJSContents=t(require('xmldom')):e.EPUBJSContents=t(e.xmldom)})('undefined'==typeof self?this:self,function(e){var t=String.prototype,n=Math.round,o=Math.max;return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=5)}([function(e,t,n){'use strict';var i=n(15)();e.exports=function(e){return e!==i&&null!==e}},function(e,t,n){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function a(){var e=new Date().getTime(),t='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(t){var n=0|(e+16*Math.random())%16;return e=g(e/16),('x'==t?n:8|7&n).toString(16)});return t}function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}function d(e,t,n,i,o){var a,r=i||0,s=o||t.length,l=parseInt(r+(s-r)/2);return(n||(n=function(e,t){return e>t?1:e<t?-1:e==t?0:void 0}),0>=s-r)?l:(a=n(t[l],e),1==s-r?0<=a?l:l+1:0===a?l:-1===a?d(e,t,n,l,s):d(e,t,n,r,l))}function s(e,t,n,i,o){var a,r=i||0,d=o||t.length,l=parseInt(r+(d-r)/2);return(n||(n=function(e,t){return e>t?1:e<t?-1:e==t?0:void 0}),0>=d-r)?-1:(a=n(t[l],e),1==d-r?0===a?l:-1:0===a?l:-1===a?s(e,t,n,l,d):s(e,t,n,r,l))}function l(e,t){for(var n,o=e.parentNode,a=o.childNodes,r=-1,d=0;d<a.length&&(n=a[d],n.nodeType===t&&r++,n!=e);d++);return r}function c(e,t){return new Blob([e],{type:t})}function u(e,t){return'undefined'==typeof e.querySelector?e.getElementsByTagName(t):e.querySelectorAll(t)}function p(e,t,n){for(var i,o=document.createTreeWalker(e,n,null,!1);i=o.nextNode();)t(i)}function h(e,t){if(t(e))return!0;if(e=e.firstChild,e)do{var n=h(e,t);if(n)return!0;e=e.nextSibling}while(e)}function f(e){for(var t=[e];e;e=e.parentNode)t.unshift(e);return t}var g=Math.floor;Object.defineProperty(t,'__esModule',{value:!0});var m=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.uuid=a,t.documentHeight=function(){return o(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},t.isElement=function(e){return!!(e&&1==e.nodeType)},t.isNumber=r,t.isFloat=function(e){var t=parseFloat(e);return t===e&&r(e)&&g(t)!==e},t.prefixed=function(e){var t=['Webkit','webkit','Moz','O','ms'],n=['-webkit-','-webkit-','-moz-','-o-','-ms-'],o=e[0].toUpperCase()+e.slice(1),a=t.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[e])return e;for(var r=0;r<a;r++)if('undefined'!=typeof document.body.style[t[r]+o])return n[r]+e;return e},t.defaults=function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n],t)void 0===e[o]&&(e[o]=t[o]);return e},t.extend=function(e){var t=[].slice.call(arguments,1);return t.forEach(function(t){t&&Object.getOwnPropertyNames(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}),e},t.insert=function(e,t,n){var i=d(e,t,n);return t.splice(i,0,e),i},t.locationOf=d,t.indexOfSorted=s,t.bounds=function(e){var t=window.getComputedStyle(e),n=0,i=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(e){n+=parseFloat(t[e])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(e){i+=parseFloat(t[e])||0}),{height:i,width:n}},t.borders=function(e){var t=window.getComputedStyle(e),n=0,i=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(e){n+=parseFloat(t[e])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(e){i+=parseFloat(t[e])||0}),{height:i,width:n}},t.windowBounds=function(){var e=window.innerWidth,t=window.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}},t.indexOfNode=l,t.indexOfTextNode=function(e){return l(e,v)},t.indexOfElementNode=function(e){return l(e,b)},t.isXml=function(e){return-1<['xml','opf','ncx'].indexOf(e)},t.createBlob=c,t.createBlobUrl=function(e,t){var n,i=c(e,t);return n=x.createObjectURL(i),n},t.revokeBlobUrl=function(e){return x.revokeObjectURL(e)},t.createBase64Url=function(e,t){var n,i;if('string'==typeof e)return n=btoa(encodeURIComponent(e)),i='data:'+t+';base64,'+n,i},t.type=function(e){return Object.prototype.toString.call(e).slice(8,-1)},t.parse=function(e,t,i){var o,a;return a='undefined'==typeof DOMParser||i?n(23).DOMParser:DOMParser,65279===e.charCodeAt(0)&&(e=e.slice(1)),o=new a().parseFromString(e,t),o},t.qs=function(e,t){var n;if(!e)throw new Error('No Element Provided');return'undefined'==typeof e.querySelector?(n=e.getElementsByTagName(t),n.length)?n[0]:void 0:e.querySelector(t)},t.qsa=u,t.qsp=function(e,t,n){var i,o;if('undefined'!=typeof e.querySelector){for(var a in t+='[',n)t+=a+'~=\''+n[a]+'\'';return t+=']',e.querySelector(t)}return(i=e.getElementsByTagName(t),o=Array.prototype.slice.call(i,0).filter(function(e){for(var t in n)if(e.getAttribute(t)===n[t])return!0;return!1}),o)?o[0]:void 0},t.sprint=function(e,t){var n=e.ownerDocument||e;'undefined'==typeof n.createTreeWalker?h(e,function(e){e&&3===e.nodeType&&t(e)},!0):p(e,t,NodeFilter.SHOW_TEXT)},t.treeWalker=p,t.walk=h,t.blob2base64=function(e){return new Promise(function(t){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(){t(n.result)}})},t.defer=function(){var e=this;this.resolve=null,this.reject=null,this.id=a(),this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),Object.freeze(this)},t.querySelectorByType=function(e,t,n){var o;if('undefined'!=typeof e.querySelector&&(o=e.querySelector(t+'[*|type="'+n+'"]')),!o||0===o.length){o=u(e,t);for(var a=0;a<o.length;a++)if(o[a].getAttributeNS('http://www.idpf.org/2007/ops','type')===n||o[a].getAttribute('epub:type')===n)return o[a]}else return o},t.findChildren=function(e){for(var t,n=[],o=e.childNodes,a=0;a<o.length;a++)t=o[a],1===t.nodeType&&n.push(t);return n},t.parents=f,t.filterChildren=function(e,t,n){for(var o,a=[],r=e.childNodes,d=0;d<r.length;d++)if(o=r[d],1===o.nodeType&&o.nodeName.toLowerCase()===t){if(n)return o;a.push(o)}if(!n)return a},t.getParentByTagName=function(e,t){var n;if(null!==e&&''!==t)for(n=e.parentNode;1===n.nodeType;){if(n.tagName.toLowerCase()===t)return n;n=n.parentNode}};var y=t.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),b=1,v=3,x='undefined'==typeof URL?'undefined'==typeof window?void 0:window.URL||window.webkitURL||window.mozURL:URL,E=t.RangeObject=function(){function e(){i(this,e),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return m(e,[{key:'setStart',value:function(e,t){this.startContainer=e,this.startOffset=t,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:'setEnd',value:function(e,t){this.endContainer=e,this.endOffset=t,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:'collapse',value:function(e){this.collapsed=!0,e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:'selectNode',value:function(e){var t=e.parentNode,n=Array.prototype.indexOf.call(t.childNodes,e);this.setStart(t,n),this.setEnd(t,n+1)}},{key:'selectNodeContents',value:function(e){var t=e.childNodes[e.childNodes-1],n=3===e.nodeType?e.textContent.length:parent.childNodes.length;this.setStart(e,0),this.setEnd(e,n)}},{key:'_commonAncestorContainer',value:function(e,t){var n=f(e||this.startContainer),o=f(t||this.endContainer);if(n[0]==o[0])for(var a=0;a<n.length;a++)if(n[a]!=o[a])return n[a-1]}},{key:'_checkCollapsed',value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:'toString',value:function(){}}]),e}()},function(e,t,n){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var o='function'==typeof Symbol&&'symbol'==typeof('function'==typeof Symbol?Symbol.iterator:'@@iterator')?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==('function'==typeof Symbol?Symbol.prototype:'@@prototype')?'symbol':typeof e};Object.defineProperty(t,'__esModule',{value:!0});var a='function'==typeof Symbol&&'symbol'===o('function'==typeof Symbol?Symbol.iterator:'@@iterator')?function(e){return'undefined'==typeof e?'undefined':o(e)}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==('function'==typeof Symbol?Symbol.prototype:'@@prototype')?'symbol':'undefined'==typeof e?'undefined':o(e)},r=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=n(1),s=1,l=3,c=function(){function e(t,n,o){i(this,e);var r;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof e))return new e(t,n,o);if('string'==typeof n?this.base=this.parseComponent(n):'object'===('undefined'==typeof n?'undefined':a(n))&&n.steps&&(this.base=n),r=this.checkType(t),'string'===r)return this.str=t,(0,d.extend)(this,this.parse(t));if('range'===r)return(0,d.extend)(this,this.fromRange(t,this.base,o));if('node'===r)return(0,d.extend)(this,this.fromNode(t,this.base,o));if('EpubCFI'===r&&t.path)return t;if(!t)return this;throw new TypeError('not a valid argument for EpubCFI')}return r(e,[{key:'checkType',value:function(t){return this.isCfiString(t)?'string':'object'===('undefined'==typeof t?'undefined':a(t))&&('Range'===(0,d.type)(t)||'undefined'!=typeof t.startContainer)?'range':'object'===('undefined'==typeof t?'undefined':a(t))&&'undefined'!=typeof t.nodeType?'node':'object'===('undefined'==typeof t?'undefined':a(t))&&t instanceof e&&'EpubCFI'}},{key:'parse',value:function(e){var t,n,i,o={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return'string'==typeof e?(0===e.indexOf('epubcfi(')&&')'===e[e.length-1]&&(e=e.slice(8,e.length-1)),t=this.getChapterComponent(e),!t)?{spinePos:-1}:(o.base=this.parseComponent(t),n=this.getPathComponent(e),o.path=this.parseComponent(n),i=this.getRange(e),i&&(o.range=!0,o.start=this.parseComponent(i[0]),o.end=this.parseComponent(i[1])),o.spinePos=o.base.steps[1].index,o):{spinePos:-1}}},{key:'parseComponent',value:function(e){var t,n={steps:[],terminal:{offset:null,assertion:null}},i=e.split(':'),o=i[0].split('/');return 1<i.length&&(t=i[1],n.terminal=this.parseTerminal(t)),''===o[0]&&o.shift(),n.steps=o.map(function(e){return this.parseStep(e)}.bind(this)),n}},{key:'parseStep',value:function(e){var t,n,i,o,a;if(o=e.match(/\[(.*)\]/),o&&o[1]&&(a=o[1]),n=parseInt(e),!isNaN(n))return 0==n%2?(t='element',i=n/2-1):(t='text',i=(n-1)/2),{type:t,index:i,id:a||null}}},{key:'parseTerminal',value:function(e){var t,n,i=e.match(/\[(.*)\]/);return i&&i[1]?(t=parseInt(e.split('[')[0]),n=i[1]):t=parseInt(e),(0,d.isNumber)(t)||(t=null),{offset:t,assertion:n}}},{key:'getChapterComponent',value:function(e){var t=e.split('!');return t[0]}},{key:'getPathComponent',value:function(e){var t=e.split('!');if(t[1]){var n=t[1].split(',');return n[0]}}},{key:'getRange',value:function(e){var t=e.split(',');return 3===t.length&&[t[1],t[2]]}},{key:'getCharecterOffsetComponent',value:function(e){var t=e.split(':');return t[1]||''}},{key:'joinSteps',value:function(e){return e?e.map(function(e){var t='';return'element'===e.type&&(t+=2*(e.index+1)),'text'===e.type&&(t+=1+2*e.index),e.id&&(t+='['+e.id+']'),t}).join('/'):''}},{key:'segmentString',value:function(e){var t='/';return t+=this.joinSteps(e.steps),e.terminal&&null!=e.terminal.offset&&(t+=':'+e.terminal.offset),e.terminal&&null!=e.terminal.assertion&&(t+='['+e.terminal.assertion+']'),t}},{key:'toString',value:function(){var e='epubcfi(';return e+=this.segmentString(this.base),e+='!',e+=this.segmentString(this.path),this.range&&this.start&&(e+=',',e+=this.segmentString(this.start)),this.range&&this.end&&(e+=',',e+=this.segmentString(this.end)),e+=')',e}},{key:'compare',value:function(t,n){var o,a,r,d,s,s;if('string'==typeof t&&(t=new e(t)),'string'==typeof n&&(n=new e(n)),t.spinePos>n.spinePos)return 1;if(t.spinePos<n.spinePos)return-1;t.range?(o=t.path.steps.concat(t.start.steps),r=t.start.terminal):(o=t.path.steps,r=t.path.terminal),n.range?(a=n.path.steps.concat(n.start.steps),d=n.start.terminal):(a=n.path.steps,d=n.path.terminal);for(var l=0;l<o.length;l++){if(!o[l])return-1;if(!a[l])return 1;if(o[l].index>a[l].index)return 1;if(o[l].index<a[l].index)return-1}return o.length<a.length?1:r.offset>d.offset?1:r.offset<d.offset?-1:0}},{key:'step',value:function(e){var t=e.nodeType===l?'text':'element';return{id:e.id,tagName:e.tagName,type:t,index:this.position(e)}}},{key:'filteredStep',value:function(e,t){var n,i=this.filter(e,t);if(i)return n=i.nodeType===l?'text':'element',{id:i.id,tagName:i.tagName,type:n,index:this.filteredPosition(i,t)}}},{key:'pathTo',value:function(e,t,n){for(var i,o={steps:[],terminal:{offset:null,assertion:null}},a=e;a&&a.parentNode&&a.parentNode.nodeType!=9;)i=n?this.filteredStep(a,n):this.step(a),i&&o.steps.unshift(i),a=a.parentNode;return null!=t&&0<=t&&(o.terminal.offset=t,'text'!=o.steps[o.steps.length-1].type&&o.steps.push({type:'text',index:0})),o}},{key:'equalStep',value:function(e,t){return e&&t&&e.index===t.index&&e.id===t.id&&e.type===t.type}},{key:'fromRange',value:function(e,t,n){var o={range:!1,base:{},path:{},start:null,end:null},r=e.startContainer,d=e.endContainer,s=e.startOffset,l=e.endOffset,c=!1;if(n&&(c=null!=r.ownerDocument.querySelector('.'+n)),'string'==typeof t?(o.base=this.parseComponent(t),o.spinePos=o.base.steps[1].index):'object'===('undefined'==typeof t?'undefined':a(t))&&(o.base=t),e.collapsed)c&&(s=this.patchOffset(r,s,n)),o.path=this.pathTo(r,s,n);else{o.range=!0,c&&(s=this.patchOffset(r,s,n)),o.start=this.pathTo(r,s,n),c&&(l=this.patchOffset(d,l,n)),o.end=this.pathTo(d,l,n),o.path={steps:[],terminal:null};var u,i=o.start.steps.length;for(u=0;u<i&&this.equalStep(o.start.steps[u],o.end.steps[u]);u++)u===i-1?o.start.terminal===o.end.terminal&&(o.path.steps.push(o.start.steps[u]),o.range=!1):o.path.steps.push(o.start.steps[u]);o.start.steps=o.start.steps.slice(o.path.steps.length),o.end.steps=o.end.steps.slice(o.path.steps.length)}return o}},{key:'fromNode',value:function(e,t,n){var i={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof t?(i.base=this.parseComponent(t),i.spinePos=i.base.steps[1].index):'object'===('undefined'==typeof t?'undefined':a(t))&&(i.base=t),i.path=this.pathTo(e,null,n),i}},{key:'filter',value:function(e,t){var n,i,o,a,r,d=!1;return e.nodeType===l?(d=!0,o=e.parentNode,n=e.parentNode.classList.contains(t)):(d=!1,n=e.classList.contains(t)),n&&d?(a=o.previousSibling,r=o.nextSibling,a&&a.nodeType===l?i=a:r&&r.nodeType===l&&(i=r),i?i:e):n&&!d?!1:e}},{key:'patchOffset',value:function(e,t,n){if(e.nodeType!=l)throw new Error('Anchor must be a text node');var i=e,o=t;for(e.parentNode.classList.contains(n)&&(i=e.parentNode);i.previousSibling;){if(i.previousSibling.nodeType!==s)o+=i.previousSibling.textContent.length;else if(i.previousSibling.classList.contains(n))o+=i.previousSibling.textContent.length;else break;i=i.previousSibling}return o}},{key:'normalizedMap',value:function(e,t,n){var o,i,a,r={},d=-1,c=e.length;for(o=0;o<c;o++)i=e[o].nodeType,i===s&&e[o].classList.contains(n)&&(i=l),0<o&&i===l&&a===l?r[o]=d:t===i&&(++d,r[o]=d),a=i;return r}},{key:'position',value:function(e){var t,n;return e.nodeType===s?(t=e.parentNode.children,!t&&(t=(0,d.findChildren)(e.parentNode)),n=Array.prototype.indexOf.call(t,e)):(t=this.textNodes(e.parentNode),n=t.indexOf(e)),n}},{key:'filteredPosition',value:function(e,t){var n,i,o;return e.nodeType===s?(n=e.parentNode.children,o=this.normalizedMap(n,s,t)):(n=e.parentNode.childNodes,e.parentNode.classList.contains(t)&&(e=e.parentNode,n=e.parentNode.childNodes),o=this.normalizedMap(n,l,t)),i=Array.prototype.indexOf.call(n,e),o[i]}},{key:'stepsToXpath',value:function(e){var t=['.','*'];return e.forEach(function(e){var n=e.index+1;e.id?t.push('*[position()='+n+' and @id=\''+e.id+'\']'):'text'===e.type?t.push('text()['+n+']'):t.push('*['+n+']')}),t.join('/')}},{key:'stepsToQuerySelector',value:function(e){var t=['html'];return e.forEach(function(e){var n=e.index+1;e.id?t.push('#'+e.id):'text'===e.type||t.push('*:nth-child('+n+')')}),t.join('>')}},{key:'textNodes',value:function(e,t){return Array.prototype.slice.call(e.childNodes).filter(function(e){return e.nodeType===l||t&&e.classList.contains(t)})}},{key:'walkToNode',value:function(e,t,n){var o,a,r,i=t||document,s=i.documentElement,l=e.length;for(r=0;r<l&&(a=e[r],'element'===a.type?a.id?s=i.getElementById(a.id):(o=s.children||(0,d.findChildren)(s),s=o[a.index]):'text'===a.type&&(s=this.textNodes(s,n)[a.index]),!!s);r++);return s}},{key:'findNode',value:function(e,t,n){var i,o,a=t||document;return n||'undefined'==typeof a.evaluate?n?i=this.walkToNode(e,a,n):i=this.walkToNode(e,a):(o=this.stepsToXpath(e),i=a.evaluate(o,a,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),i}},{key:'fixMiss',value:function(e,t,n,i){var o,a,r=this.findNode(e.slice(0,-1),n,i),d=r.childNodes,c=this.normalizedMap(d,l,i),u=e[e.length-1].index;for(var p in c){if(!c.hasOwnProperty(p))return;if(c[p]===u)if(o=d[p],a=o.textContent.length,t>a)t-=a;else{r=o.nodeType===s?o.childNodes[0]:o;break}}return{container:r,offset:t}}},{key:'toRange',value:function(e,t){var n,i,o,a,r,s,l,c,u=e||document,p=this,h=!!t&&null!=u.querySelector('.'+t);if(n='undefined'==typeof u.createRange?new d.RangeObject:u.createRange(),p.range?(i=p.start,s=p.path.steps.concat(i.steps),a=this.findNode(s,u,h?t:null),o=p.end,l=p.path.steps.concat(o.steps),r=this.findNode(l,u,h?t:null)):(i=p.path,s=p.path.steps,a=this.findNode(p.path.steps,u,h?t:null)),a)try{null==i.terminal.offset?n.setStart(a,0):n.setStart(a,i.terminal.offset)}catch(o){c=this.fixMiss(s,i.terminal.offset,u,h?t:null),n.setStart(c.container,c.offset)}else return console.log('No startContainer found for',this.toString()),null;if(r)try{null==o.terminal.offset?n.setEnd(r,0):n.setEnd(r,o.terminal.offset)}catch(i){c=this.fixMiss(l,p.end.terminal.offset,u,h?t:null),n.setEnd(c.container,c.offset)}return n}},{key:'isCfiString',value:function(e){return'string'==typeof e&&0===e.indexOf('epubcfi(')&&')'===e[e.length-1]}},{key:'generateChapterComponent',value:function(e,t,n){var i=parseInt(t),o='/'+2*(e+1)+'/';return o+=2*(i+1),n&&(o+='['+n+']'),o}},{key:'collapse',value:function(e){this.range&&(this.range=!1,e?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),e}();t.default=c,e.exports=t['default']},function(e,t,n){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var o=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a),d=function(){function e(t){i(this,e);var n,o;n=t.indexOf('://'),-1<n&&(t=new URL(t).pathname),o=this.parse(t),this.path=t,this.directory=this.isDirectory(t)?t:o.dir+'/',this.filename=o.base,this.extension=o.ext.slice(1)}return o(e,[{key:'parse',value:function(e){return r.default.parse(e)}},{key:'isAbsolute',value:function(e){return r.default.isAbsolute(e||this.path)}},{key:'isDirectory',value:function(e){return'/'===e.charAt(e.length-1)}},{key:'resolve',value:function(e){return r.default.resolve(this.directory,e)}},{key:'relative',value:function(e){return r.default.relative(this.directory,e)}},{key:'splitPath',value:function(e){return this.splitPathRe.exec(e).slice(1)}},{key:'toString',value:function(){return this.path}}]),e}();t.default=d,e.exports=t['default']},function(e){'use strict';function t(e){if('string'!=typeof e)throw new TypeError('Path must be a string. Received '+e)}function n(e,t){for(var n,o='',a=-1,r=0,d=0;d<=e.length;++d){if(d<e.length)n=e.charCodeAt(d);else if(47===n)break;else n=47;if(47===n){if(a==d-1||1==r);else if(a!=d-1&&2==r){if(2>o.length||46!==o.charCodeAt(o.length-1)||46!==o.charCodeAt(o.length-2))if(2<o.length){for(var i=o.length-1,s=i;0<=s&&47!==o.charCodeAt(s);--s);if(s!=i){o=-1==s?'':o.slice(0,s),a=d,r=0;continue}}else if(2===o.length||1===o.length){o='',a=d,r=0;continue}t&&(0<o.length?o+='/..':o='..')}else 0<o.length?o+='/'+e.slice(a+1,d):o=e.slice(a+1,d);a=d,r=0}else 46===n&&-1!=r?++r:r=-1}return o}function i(e,t){var n=t.dir||t.root,i=t.base||(t.name||'')+(t.ext||'');return n?n===t.root?n+i:n+e+i:i}var o='function'==typeof Symbol&&'symbol'==typeof('function'==typeof Symbol?Symbol.iterator:'@@iterator')?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==('function'==typeof Symbol?Symbol.prototype:'@@prototype')?'symbol':typeof e};if(!a)var a={cwd:function(){return'/'}};var r={resolve:function(){for(var e,o='',r=!1,d=arguments.length-1;-1<=d&&!r;d--){var i;(0<=d?i=arguments[d]:(void 0==e&&(e=a.cwd()),i=e),t(i),0!==i.length)&&(o=i+'/'+o,r=47===i.charCodeAt(0))}return o=n(o,!r),r?0<o.length?'/'+o:'/':0<o.length?o:'.'},normalize:function(e){if(t(e),0===e.length)return'.';var i=47===e.charCodeAt(0),o=47===e.charCodeAt(e.length-1);return e=n(e,!i),0!==e.length||i||(e='.'),0<e.length&&o&&(e+='/'),i?'/'+e:e},isAbsolute:function(e){return t(e),0<e.length&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var e,n,o=0;o<arguments.length;++o)n=arguments[o],t(n),0<n.length&&(void 0==e?e=n:e+='/'+n);return void 0===e?'.':r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return'';if(e=r.resolve(e),n=r.resolve(n),e===n)return'';for(var o=1;o<e.length&&47===e.charCodeAt(o);++o);for(var a=e.length,d=a-o,s=1;s<n.length&&47===n.charCodeAt(s);++s);for(var l=n.length,c=l-s,u=d<c?d:c,p=-1,h=0;h<=u;++h){if(h==u){if(c>u){if(47===n.charCodeAt(s+h))return n.slice(s+h+1);if(0==h)return n.slice(s+h)}else d>u&&(47===e.charCodeAt(o+h)?p=h:0==h&&(p=0));break}var i=e.charCodeAt(o+h),f=n.charCodeAt(s+h);if(i!==f)break;else 47===i&&(p=h)}var g='';for(h=o+p+1;h<=a;++h)(h===a||47===e.charCodeAt(h))&&(g+=0===g.length?'..':'/..');return 0<g.length?g+n.slice(s+p):(s+=p,47===n.charCodeAt(s)&&++s,n.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return'.';for(var n=e.charCodeAt(0),o=47===n,a=-1,r=!0,d=e.length-1;1<=d;--d)if(n=e.charCodeAt(d),47!==n)r=!1;else if(!r){a=d;break}return-1===a?o?'/':'.':o&&1===a?'//':e.slice(0,a)},basename:function(e,n){if(n!==void 0&&'string'!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var o,i=0,a=-1,r=!0;if(void 0!==n&&0<n.length&&n.length<=e.length){if(n.length===e.length&&n===e)return'';var d=n.length-1,s=-1;for(o=e.length-1;0<=o;--o){var l=e.charCodeAt(o);if(47!==l)-1==s&&(r=!1,s=o+1),0<=d&&(l===n.charCodeAt(d)?-1==--d&&(a=o):(d=-1,a=s));else if(!r){i=o+1;break}}return i===a?a=s:-1===a&&(a=e.length),e.slice(i,a)}for(o=e.length-1;0<=o;--o)if(47!==e.charCodeAt(o))-1==a&&(r=!1,a=o+1);else if(!r){i=o+1;break}return-1===a?'':e.slice(i,a)},extname:function(e){t(e);for(var n,o=-1,a=0,r=-1,d=!0,s=0,l=e.length-1;0<=l;--l){if(n=e.charCodeAt(l),47===n){if(!d){a=l+1;break}continue}-1==r&&(d=!1,r=l+1),46===n?-1==o?o=l:1!=s&&(s=1):-1!==o&&(s=-1)}return-1===o||-1===r||0==s||1==s&&o===r-1&&o===a+1?'':e.slice(o,r)},format:function(e){if(null===e||'object'!==('undefined'==typeof e?'undefined':o(e)))throw new TypeError('Parameter "pathObject" must be an object, not '+('undefined'==typeof e?'undefined':o(e)));return i('/',e)},parse:function(e){t(e);var n={root:'',dir:'',base:'',ext:'',name:''};if(0===e.length)return n;var o,a=e.charCodeAt(0),r=47===a;r?(n.root='/',o=1):o=0;for(var d=-1,s=0,l=-1,c=!0,u=e.length-1,i=0;u>=o;--u){if(a=e.charCodeAt(u),47===a){if(!c){s=u+1;break}continue}-1==l&&(c=!1,l=u+1),46===a?-1==d?d=u:1!=i&&(i=1):-1!=d&&(i=-1)}return-1==d||-1==l||0==i||1==i&&d==l-1&&d==s+1?-1!=l&&(0==s&&r?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(s,l)):(0==s&&r?(n.name=e.slice(1,d),n.base=e.slice(1,l)):(n.name=e.slice(s,d),n.base=e.slice(s,l)),n.ext=e.slice(d,l)),0<s?n.dir=e.slice(0,s-1):r&&(n.dir='/'),n},sep:'/',delimiter:':',posix:null};e.exports=r},function(e,t,n){'use strict';var i=n(6);e.exports=i},function(e,t,i){'use strict';function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var r=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d=i(7),s=o(d),l=i(1),c=i(2),u=o(c),p=i(24),h=o(p),f=i(25),g=i(27),m=/Chrome/.test(navigator.userAgent),y=!m&&/AppleWebKit/.test(navigator.userAgent),b=function(){function e(t,n,i,o){a(this,e),this.epubcfi=new u.default,this.document=t,this.documentElement=this.document.documentElement,this.content=n||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=o||0,this.cfiBase=i||'',this.epubReadingSystem('epub.js',ePub.VERSION),this.listeners()}return r(e,[{key:'width',value:function(e){var t=this.content;return e&&(0,l.isNumber)(e)&&(e+='px'),e&&(t.style.width=e),this.window.getComputedStyle(t).width}},{key:'height',value:function(e){var t=this.content;return e&&(0,l.isNumber)(e)&&(e+='px'),e&&(t.style.height=e),this.window.getComputedStyle(t).height}},{key:'contentWidth',value:function(e){var t=this.content||this.document.body;return e&&(0,l.isNumber)(e)&&(e+='px'),e&&(t.style.width=e),this.window.getComputedStyle(t).width}},{key:'contentHeight',value:function(e){var t=this.content||this.document.body;return e&&(0,l.isNumber)(e)&&(e+='px'),e&&(t.style.height=e),this.window.getComputedStyle(t).height}},{key:'textWidth',value:function(){var e,t=this.document.createRange(),i=this.content||this.document.body,o=(0,l.borders)(i);return t.selectNodeContents(i),e=t.getBoundingClientRect().width,o&&o.width&&(e+=o.width),n(e)}},{key:'textHeight',value:function(){var e,t=this.document.createRange(),i=this.content||this.document.body,o=(0,l.borders)(i);return t.selectNodeContents(i),e=t.getBoundingClientRect().height,e&&o.height&&(e+=o.height),n(e)}},{key:'scrollWidth',value:function(){var e=this.documentElement.scrollWidth;return e}},{key:'scrollHeight',value:function(){var e=this.documentElement.scrollHeight;return e}},{key:'overflow',value:function(e){return e&&(this.documentElement.style.overflow=e),this.window.getComputedStyle(this.documentElement).overflow}},{key:'overflowX',value:function(e){return e&&(this.documentElement.style.overflowX=e),this.window.getComputedStyle(this.documentElement).overflowX}},{key:'overflowY',value:function(e){return e&&(this.documentElement.style.overflowY=e),this.window.getComputedStyle(this.documentElement).overflowY}},{key:'css',value:function(e,t,n){var i=this.content||this.document.body;return t&&i.style.setProperty(e,t,n?'important':''),this.window.getComputedStyle(i)[e]}},{key:'viewport',value:function(e){var t=this.document.querySelector('meta[name=\'viewport\']'),n={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},i=[],o={};if(t&&t.hasAttribute('content')){var a=t.getAttribute('content'),r=a.match(/width\s*=\s*([^,]*)/),d=a.match(/height\s*=\s*([^,]*)/),s=a.match(/initial-scale\s*=\s*([^,]*)/),c=a.match(/minimum-scale\s*=\s*([^,]*)/),u=a.match(/maximum-scale\s*=\s*([^,]*)/),p=a.match(/user-scalable\s*=\s*([^,]*)/);r&&r.length&&'undefined'!=typeof r[1]&&(n.width=r[1]),d&&d.length&&'undefined'!=typeof d[1]&&(n.height=d[1]),s&&s.length&&'undefined'!=typeof s[1]&&(n.scale=s[1]),c&&c.length&&'undefined'!=typeof c[1]&&(n.minimum=c[1]),u&&u.length&&'undefined'!=typeof u[1]&&(n.maximum=u[1]),p&&p.length&&'undefined'!=typeof p[1]&&(n.scalable=p[1])}return o=(0,l.defaults)(e||{},n),e&&(o.width&&i.push('width='+o.width),o.height&&i.push('height='+o.height),o.scale&&i.push('initial-scale='+o.scale),'no'===o.scalable?(i.push('minimum-scale='+o.scale),i.push('maximum-scale='+o.scale),i.push('user-scalable='+o.scalable)):(o.scalable&&i.push('user-scalable='+o.scalable),o.minimum&&i.push('minimum-scale='+o.minimum),o.maximum&&i.push('minimum-scale='+o.maximum)),!t&&(t=this.document.createElement('meta'),t.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(t)),t.setAttribute('content',i.join(', ')),this.window.scrollTo(0,0)),o}},{key:'expand',value:function(){this.emit(g.EVENTS.CONTENTS.EXPAND)}},{key:'listeners',value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:'removeListeners',value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:'resizeCheck',value:function(){var e=this.textWidth(),t=this.textHeight();(e!=this._size.width||t!=this._size.height)&&(this._size={width:e,height:t},this.onResize&&this.onResize(this._size),this.emit(g.EVENTS.CONTENTS.RESIZE,this._size))}},{key:'resizeListeners',value:function(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:'transitionListeners',value:function(){var e=this.content;e.style.transitionProperty='font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height',e.style.transitionDuration='0.001ms',e.style.transitionTimingFunction='linear',e.style.transitionDelay='0',this.document.addEventListener('transitionend',this.resizeCheck.bind(this))}},{key:'mediaQueryListeners',value:function(){for(var e=this.document.styleSheets,t=function(e){e.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),n=0;n<e.length;n+=1){var i;try{i=e[n].cssRules}catch(t){return}if(!i)return;for(var o=0;o<i.length;o+=1)if(i[o].media){var a=this.window.matchMedia(i[o].media.mediaText);a.addListener(t)}}}},{key:'resizeObservers',value:function(){var e=this;this.observer=new MutationObserver(function(){e.resizeCheck()});this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}},{key:'imageLoadListeners',value:function(){for(var e,t=this.document.querySelectorAll('img'),n=0;n<t.length;n++)e=t[n],'undefined'!=typeof e.naturalWidth&&0===e.naturalWidth&&(e.onload=this.expand.bind(this))}},{key:'fontLoadListeners',value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}},{key:'root',value:function(){return this.document?this.document.documentElement:null}},{key:'locationOf',value:function(e,t){var n,i={left:0,top:0};if(!this.document)return i;if(this.epubcfi.isCfiString(e)){var o=new u.default(e).toRange(this.document,t);if(o)if(o.startContainer.nodeType===Node.ELEMENT_NODE)n=o.startContainer.getBoundingClientRect(),i.left=n.left,i.top=n.top;else if(y){var a=o.startContainer,r=new Range;try{a.nodeType===1?n=a.getBoundingClientRect():o.startOffset+2<a.length?(r.setStart(a,o.startOffset),r.setEnd(a,o.startOffset+2),n=r.getBoundingClientRect()):0<o.startOffset-2?(r.setStart(a,o.startOffset-2),r.setEnd(a,o.startOffset),n=r.getBoundingClientRect()):n=a.parentNode.getBoundingClientRect()}catch(t){console.error(t,t.stack)}}else n=o.getBoundingClientRect()}else if('string'==typeof e&&-1<e.indexOf('#')){var d=e.substring(e.indexOf('#')+1),s=this.document.getElementById(d);s&&(n=s.getBoundingClientRect())}return n&&(i.left=n.left,i.top=n.top),i}},{key:'addStylesheet',value:function(e){return new Promise(function(t){var n,i=!1;return this.document?(n=this.document.querySelector('link[href=\''+e+'\']'),n?void t(!0):void(n=this.document.createElement('link'),n.type='text/css',n.rel='stylesheet',n.href=e,n.onload=n.onreadystatechange=function(){i||this.readyState&&'complete'!=this.readyState||(i=!0,setTimeout(function(){t(!0)},1))},this.document.head.appendChild(n))):void t(!1)}.bind(this))}},{key:'addStylesheetRules',value:function(e){var t,n,o='epubjs-inserted-css';if(this.document&&e&&0!==e.length)if(t=this.document.getElementById('#'+o),t||(t=this.document.createElement('style'),t.id=o),this.document.head.appendChild(t),n=t.sheet,'[object Array]'===Object.prototype.toString.call(e))for(var a=0,i=e.length;a<i;a++){var r=1,d=e[a],s=e[a][0],l='';'[object Array]'===Object.prototype.toString.call(d[1][0])&&(d=d[1],r=0);for(var c,u=d.length;r<u;r++)c=d[r],l+=c[0]+':'+c[1]+(c[2]?' !important':'')+';\n';n.insertRule(s+'{'+l+'}',n.cssRules.length)}else{var p=Object.keys(e);p.forEach(function(t){var i=e[t];if(Array.isArray(i))i.forEach(function(e){var i=Object.keys(e),o=i.map(function(t){return t+':'+e[t]}).join(';');n.insertRule(t+'{'+o+'}',n.cssRules.length)});else{var o=Object.keys(i),a=o.map(function(e){return e+':'+i[e]}).join(';');n.insertRule(t+'{'+a+'}',n.cssRules.length)}})}}},{key:'addScript',value:function(e){return new Promise(function(t){var n,i=!1;return this.document?void(n=this.document.createElement('script'),n.type='text/javascript',n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){i||this.readyState&&'complete'!=this.readyState||(i=!0,setTimeout(function(){t(!0)},1))},this.document.head.appendChild(n)):void t(!1)}.bind(this))}},{key:'addClass',value:function(e){var t;this.document&&(t=this.content||this.document.body,t&&t.classList.add(e))}},{key:'removeClass',value:function(e){var t;this.document&&(t=this.content||this.document.body,t&&t.classList.remove(e))}},{key:'addEventListeners',value:function(){this.document&&g.DOM_EVENTS.forEach(function(e){this.document.addEventListener(e,this.triggerEvent.bind(this),!1)},this)}},{key:'removeEventListeners',value:function(){this.document&&g.DOM_EVENTS.forEach(function(e){this.document.removeEventListener(e,this.triggerEvent,!1)},this)}},{key:'triggerEvent',value:function(t){this.emit(t.type,t)}},{key:'addSelectionListeners',value:function(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}},{key:'removeSelectionListeners',value:function(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}},{key:'onSelectionChange',value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var e=this.window.getSelection();this.triggerSelectedEvent(e)}.bind(this),250)}},{key:'triggerSelectedEvent',value:function(e){var t,n;e&&0<e.rangeCount&&(t=e.getRangeAt(0),!t.collapsed&&(n=new u.default(t,this.cfiBase).toString(),this.emit(g.EVENTS.CONTENTS.SELECTED,n),this.emit(g.EVENTS.CONTENTS.SELECTED_RANGE,t)))}},{key:'range',value:function(e,t){var n=new u.default(e);return n.toRange(this.document,t)}},{key:'cfiFromRange',value:function(e,t){return new u.default(e,this.cfiBase,t).toString()}},{key:'cfiFromNode',value:function(e,t){return new u.default(e,this.cfiBase,t).toString()}},{key:'map',value:function(e){var t=new h.default(e);return t.section()}},{key:'size',value:function(e,t){var n={scale:1,scalable:'no'};this.layoutStyle('scrolling'),0<=e&&(this.width(e),n.width=e,this.css('padding','0 '+e/12+'px',!0)),0<=t&&(this.height(t),n.height=t),this.css('margin','0'),this.css('box-sizing','border-box'),this.viewport(n)}},{key:'columns',value:function(e,t,n,i){var o=(0,l.prefixed)('column-axis'),a=(0,l.prefixed)('column-gap'),r=(0,l.prefixed)('column-width'),d=(0,l.prefixed)('column-fill'),s=this.writingMode(),c=0===s.indexOf('vertical')?'vertical':'horizontal';this.layoutStyle('paginated'),'rtl'===this.content.dir&&this.direction('rtl'),this.width(e),this.height(t),this.viewport({width:e,height:t,scale:1,scalable:'no'}),this.css('overflow-y','hidden'),this.css('margin','0',!0),'vertical'==c?this.css('padding',i/2+'px 20px',!0):this.css('padding','20px '+i/2+'px',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(o,'horizontal'),this.css(d,'auto'),this.css(a,i+'px'),this.css(r,n+'px')}},{key:'scaler',value:function(e,t,n){var i='';this.css('transform-origin','top left'),(0<=t||0<=n)&&(i=' translate('+(t||0)+'px, '+(n||0)+'px )'),this.css('transform','scale('+e+')'+i)}},{key:'fit',value:function(e,t){var n=this.viewport(),i=e/parseInt(n.width),o=t/parseInt(n.height),a=i<o?i:o,r=(t-n.height*a)/2;this.layoutStyle('paginated'),this.width(e),this.height(t),this.overflow('hidden'),this.scaler(a,0,r),this.css('background-color','transparent')}},{key:'direction',value:function(e){this.documentElement&&(this.documentElement.style.direction=e)}},{key:'mapPage',value:function(e,t,n,i,o){var a=new h.default(t,o);return a.page(this,e,n,i)}},{key:'linksHandler',value:function(){var e=this;(0,f.replaceLinks)(this.content,function(t){e.emit(g.EVENTS.CONTENTS.LINK_CLICKED,t)})}},{key:'writingMode',value:function(e){var t=(0,l.prefixed)('writing-mode');return e&&this.documentElement&&(this.documentElement.style[t]=e),this.window.getComputedStyle(this.documentElement)[t]||''}},{key:'layoutStyle',value:function(e){return e&&(this._layoutStyle=e,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||'paginated'}},{key:'epubReadingSystem',value:function(e,t){return navigator.epubReadingSystem={name:e,version:t,layoutStyle:this.layoutStyle(),hasFeature:function(e){return'dom-manipulation'===e||'layout-changes'===e||'touch-events'===e||'mouse-events'===e||'keyboard-events'===e||'spine-scripting'!==e&&!1}},navigator.epubReadingSystem}},{key:'destroy',value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener('transitionend',this.resizeCheck),this.removeListeners()}}],[{key:'listenedEvents',get:function(){return g.DOM_EVENTS}}]),e}();(0,s.default)(b.prototype),t.default=b,e.exports=t['default']},function(e,t,n){'use strict';var i,o,a,r,s,l,c,u='function'==typeof Symbol&&'symbol'==typeof('function'==typeof Symbol?Symbol.iterator:'@@iterator')?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==('function'==typeof Symbol?Symbol.prototype:'@@prototype')?'symbol':typeof e},p=n(8),d=n(22),h=Function.prototype.apply,f=Function.prototype.call,g=Object.create,m=Object.defineProperty,y=Object.defineProperties,b=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n;return d(t),b.call(this,'__ee__')?n=this.__ee__:(n=v.value=g(null),m(this,'__ee__',v),v.value=null),n[e]?'object'===u(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},o=function(e,t){var n,o;return d(t),o=this,i.call(this,e,n=function(){a.call(o,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a=function(e,t){var n,o,a,r;if(d(t),!b.call(this,'__ee__'))return this;if(n=this.__ee__,!n[e])return this;if(o=n[e],'object'===('undefined'==typeof o?'undefined':u(o)))for(r=0;a=o[r];++r)(a===t||a.__eeOnceListener__===t)&&(2===o.length?n[e]=o[r?0:1]:o.splice(r,1));else(o===t||o.__eeOnceListener__===t)&&delete n[e];return this},r=function(e){var t,n,i,o,a;if(b.call(this,'__ee__')&&(o=this.__ee__[e],!!o))if('object'===('undefined'==typeof o?'undefined':u(o))){for(n=arguments.length,a=Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];for(o=o.slice(),t=0;i=o[t];++t)h.call(i,this,a)}else switch(arguments.length){case 1:f.call(o,this);break;case 2:f.call(o,this,arguments[1]);break;case 3:f.call(o,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];h.call(o,this,a);}},s={on:i,once:o,off:a,emit:r},l={on:p(i),once:p(o),off:p(a),emit:p(r)},c=y({},l),e.exports=t=function(e){return null==e?g(c):y(Object(e),l)},t.methods=s},function(e,t,n){'use strict';var i,o=n(9),a=n(17),r=n(18),d=n(19);i=e.exports=function(t,n){var i,r,s,l,u;return 2>arguments.length||'string'!=typeof t?(l=n,n=t,t=null):l=arguments[2],null==t?(i=s=!0,r=!1):(i=d.call(t,'c'),r=d.call(t,'e'),s=d.call(t,'w')),u={value:n,configurable:i,enumerable:r,writable:s},l?o(a(l),u):u},i.gs=function(t,n,i){var s,l,u,p;return'string'==typeof t?u=arguments[3]:(u=i,i=n,n=t,t=null),null==n?n=void 0:r(n)?null==i?i=void 0:!r(i)&&(u=i,i=void 0):(u=n,n=i=void 0),null==t?(s=!0,l=!1):(s=d.call(t,'c'),l=d.call(t,'e')),p={get:n,set:i,configurable:s,enumerable:l},u?o(a(u),p):p}},function(e,t,n){'use strict';e.exports=n(10)()?Object.assign:n(11)},function(e){'use strict';e.exports=function(){var e,t=Object.assign;return!('function'!=typeof t)&&(e={foo:'raz'},t(e,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===e.foo+e.bar+e.trzy)}},function(e,t,n){'use strict';var a=n(12),r=n(16);e.exports=function(e,t){var n,d,i,s=o(arguments.length,2);for(e=Object(r(e)),i=function(i){try{e[i]=t[i]}catch(t){n||(n=t)}},d=1;d<s;++d)t=arguments[d],a(t).forEach(i);if(n!==void 0)throw n;return e}},function(e,t,n){'use strict';e.exports=n(13)()?Object.keys:n(14)},function(e){'use strict';e.exports=function(){try{return Object.keys('primitive'),!0}catch(t){return!1}}},function(e,t,n){'use strict';var i=n(0),o=Object.keys;e.exports=function(e){return o(i(e)?Object(e):e)}},function(e){'use strict';e.exports=function(){}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){if(!i(e))throw new TypeError('Cannot use null or undefined');return e}},function(e,t,n){'use strict';var i=n(0),o=Array.prototype.forEach,a=Object.create,r=function(e,t){for(var n in e)t[n]=e[n]};e.exports=function(){var e=a(null);return o.call(arguments,function(t){i(t)&&r(Object(t),e)}),e}},function(e){'use strict';e.exports=function(e){return'function'==typeof e}},function(e,n,i){'use strict';e.exports=i(20)()?t.contains:i(21)},function(e){'use strict';var t='razdwatrzy';e.exports=function(){return!('function'!=typeof t.contains)&&!0===t.contains('dwa')&&!1===t.contains('foo')}},function(e){'use strict';var n=t.indexOf;e.exports=function(e){return-1<n.call(this,e,arguments[1])}},function(e){'use strict';e.exports=function(e){if('function'!=typeof e)throw new TypeError(e+' is not a function');return e}},function(t){t.exports=e},function(e,t,i){'use strict';function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var a=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=i(2),d=function(e){return e&&e.__esModule?e:{default:e}}(r),s=function(){function e(t,n,i,a){o(this,e),this.layout=t,this.horizontal='horizontal'===i,this.direction=n||'ltr',this._dev=a}return a(e,[{key:'section',value:function(e){var t=this.findRanges(e),n=this.rangeListToCfiList(e.section.cfiBase,t);return n}},{key:'page',value:function(e,t,n,i){var o,a=e&&e.document&&e.document.body;if(a){if(o=this.rangePairToCfiPair(t,{start:this.findStart(a,n,i),end:this.findEnd(a,n,i)}),!0===this._dev){var s=e.document,l=new d.default(o.start).toRange(s),c=new d.default(o.end).toRange(s),u=s.defaultView.getSelection(),p=s.createRange();u.removeAllRanges(),p.setStart(l.startContainer,l.startOffset),p.setEnd(c.endContainer,c.endOffset),u.addRange(p)}return o}}},{key:'walk',value:function(e,t){if(!(e&&e.nodeType===Node.TEXT_NODE)){var n={acceptNode:function(e){return 0<e.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},i=n.acceptNode;i.acceptNode=n.acceptNode;for(var o,a,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,i,!1);(o=r.nextNode())&&(a=t(o),!a););return a}}},{key:'findRanges',value:function(e){for(var t,n,o=[],a=e.contents.scrollWidth(),r=Math.ceil(a/this.layout.spreadWidth),d=r*this.layout.divisor,s=this.layout.columnWidth,l=this.layout.gap,c=0;c<d.pages;c++)t=(s+l)*c,n=s*(c+1)+l*c,o.push({start:this.findStart(e.document.body,t,n),end:this.findEnd(e.document.body,t,n)});return o}},{key:'findStart',value:function(e,t,n){for(var i,o,a=this,r=[e],d=e;r.length;)if(i=r.shift(),o=this.walk(i,function(e){var i,o,s,l,c;if(c=a.getBounds(e),a.horizontal&&'ltr'===a.direction){if(i=a.horizontal?c.left:c.top,o=a.horizontal?c.right:c.bottom,i>=t&&i<=n)return e;if(o>t)return e;d=e,r.push(e)}else if(a.horizontal&&'rtl'===a.direction){if(i=c.left,o=c.right,o<=n&&o>=t)return e;if(i<n)return e;d=e,r.push(e)}else{if(s=c.top,l=c.bottom,s>=t&&s<=n)return e;if(l>t)return e;d=e,r.push(e)}}),o)return this.findTextStartRange(o,t,n);return this.findTextStartRange(d,t,n)}},{key:'findEnd',value:function(e,t,i){for(var o,a,r=this,d=[e],s=e;d.length;)if(o=d.shift(),a=this.walk(o,function(e){var o,a,l,c,u;if(u=r.getBounds(e),r.horizontal&&'ltr'===r.direction){if(o=n(u.left),a=n(u.right),o>i&&s)return s;if(a>i)return e;s=e,d.push(e)}else if(r.horizontal&&'rtl'===r.direction){if(o=n(r.horizontal?u.left:u.top),a=n(r.horizontal?u.right:u.bottom),a<t&&s)return s;if(o<t)return e;s=e,d.push(e)}else{if(l=n(u.top),c=n(u.bottom),l>i&&s)return s;if(c>i)return e;s=e,d.push(e)}}),a)return this.findTextEndRange(a,t,i);return this.findTextEndRange(s,t,i)}},{key:'findTextStartRange',value:function(e,t,n){for(var o,a,r,d,s,l=this.splitTextNodeIntoRanges(e),c=0;c<l.length;c++)if(o=l[c],a=o.getBoundingClientRect(),this.horizontal&&'ltr'===this.direction){if(r=a.left,r>=t)return o;}else if(this.horizontal&&'rtl'===this.direction){if(s=a.right,s<=n)return o;}else if(d=a.top,d>=t)return o;return l[0]}},{key:'findTextEndRange',value:function(e,t,n){for(var o,a,r,d,s,l,c,u=this.splitTextNodeIntoRanges(e),p=0;p<u.length;p++){if(a=u[p],r=a.getBoundingClientRect(),this.horizontal&&'ltr'===this.direction){if(d=r.left,s=r.right,d>n&&o)return o;if(s>n)return a}else if(this.horizontal&&'rtl'===this.direction){if(d=r.left,s=r.right,s<t&&o)return o;if(d<t)return a}else{if(l=r.top,c=r.bottom,l>n&&o)return o;if(c>n)return a}o=a}return u[u.length-1]}},{key:'splitTextNodeIntoRanges',value:function(e,t){var n,i=[],o=e.textContent||'',a=o.trim(),r=e.ownerDocument,d=t||' ',s=a.indexOf(d);if(-1===s||e.nodeType!=Node.TEXT_NODE)return n=r.createRange(),n.selectNodeContents(e),[n];for(n=r.createRange(),n.setStart(e,0),n.setEnd(e,s),i.push(n),n=!1;-1!=s;)s=a.indexOf(d,s+1),0<s&&(n&&(n.setEnd(e,s),i.push(n)),n=r.createRange(),n.setStart(e,s+1));return n&&(n.setEnd(e,a.length),i.push(n)),i}},{key:'rangePairToCfiPair',value:function(e,t){var n=t.start,i=t.end;n.collapse(!0),i.collapse(!1);var o=new d.default(n,e).toString(),a=new d.default(i,e).toString();return{start:o,end:a}}},{key:'rangeListToCfiList',value:function(e,t){for(var n,o=[],a=0;a<t.length;a++)n=this.rangePairToCfiPair(e,t[a]),o.push(n);return o}},{key:'getBounds',value:function(e){var t;if(e.nodeType==Node.TEXT_NODE){var n=document.createRange();n.selectNodeContents(e),t=n.getBoundingClientRect()}else t=e.getBoundingClientRect();return t}},{key:'axis',value:function(e){return e&&(this.horizontal='horizontal'===e),this.horizontal}}]),e}();t.default=s,e.exports=t['default']},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.replaceBase=function(e,t){var n,i,a=t.url,r=-1<a.indexOf('://');e&&(i=(0,o.qs)(e,'head'),n=(0,o.qs)(i,'base'),!n&&(n=e.createElement('base'),i.insertBefore(n,i.firstChild)),!r&&window&&window.location&&(a=window.location.origin+a),n.setAttribute('href',a))},t.replaceCanonical=function(e,t){var n,i,a=t.canonical;e&&(n=(0,o.qs)(e,'head'),i=(0,o.qs)(n,'link[rel=\'canonical\']'),i?i.setAttribute('href',a):(i=e.createElement('link'),i.setAttribute('rel','canonical'),i.setAttribute('href',a),n.appendChild(i)))},t.replaceMeta=function(e,t){var n,i,a=t.idref;e&&(n=(0,o.qs)(e,'head'),i=(0,o.qs)(n,'link[property=\'dc.identifier\']'),i?i.setAttribute('content',a):(i=e.createElement('meta'),i.setAttribute('name','dc.identifier'),i.setAttribute('content',a),n.appendChild(i)))},t.replaceLinks=function(e,t){var n=e.querySelectorAll('a[href]');if(n.length)for(var a=(0,o.qs)(e.ownerDocument,'base'),d=a?a.getAttribute('href'):void 0,s=function(e){var n=e.getAttribute('href');if(0!==n.indexOf('mailto:')){var i=-1<n.indexOf('://'),o=new r.default(n,d);i?e.setAttribute('target','_blank'):e.onclick=function(){return o&&o.hash?t(o.Path.path+o.hash):o?t(o.Path.path):t(n),!1}}}.bind(this),l=0;l<n.length;l++)s(n[l])},t.substitute=function(e,t,n){return t.forEach(function(t,o){t&&n[o]&&(e=e.replace(new RegExp(t,'g'),n[o]))}),e};var o=n(1),a=n(26),r=i(a),d=n(3),s=i(d)},function(e,t,n){'use strict';function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var a=function(){function e(e,t){for(var n,o=0;o<t.length;o++)n=t[o],n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(3),d=i(r),s=n(4),l=i(s),c=function(){function e(t,n){o(this,e);var i,a=-1<t.indexOf('://'),r=t;if(this.Url=void 0,this.href=t,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=n,!a&&!1!==n&&'string'!=typeof n&&window&&window.location&&(this.base=window.location.href),a||this.base)try{this.Url=this.base?new URL(t,this.base):new URL(t),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,r=this.Url.pathname}catch(t){this.Url=void 0,this.base&&(i=new d.default(this.base),r=i.resolve(r))}this.Path=new d.default(r),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return a(e,[{key:'path',value:function(){return this.Path}},{key:'resolve',value:function(e){var t,n=-1<e.indexOf('://');return n?e:(t=l.default.resolve(this.directory,e),this.origin+t)}},{key:'relative',value:function(e){return l.default.relative(e,this.directory)}},{key:'toString',value:function(){return this.href}}]),e}();t.default=c,e.exports=t['default']},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=t.DOM_EVENTS=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],i=t.EVENTS={BOOK:{OPEN_FAILED:'openFailed'},CONTENTS:{EXPAND:'expand',RESIZE:'resize',SELECTED:'selected',SELECTED_RANGE:'selectedRange',LINK_CLICKED:'linkClicked'},LOCATIONS:{CHANGED:'changed'},MANAGERS:{RESIZE:'resize',RESIZED:'resized',ORIENTATION_CHANGE:'orientationchange',ADDED:'added',SCROLL:'scroll',SCROLLED:'scrolled'},VIEWS:{AXIS:'axis',LOAD_ERROR:'loaderror',RENDERED:'rendered',RESIZED:'resized',DISPLAYED:'displayed',SHOWN:'shown',HIDDEN:'hidden',MARK_CLICKED:'markClicked'},RENDITION:{STARTED:'started',ATTACHED:'attached',DISPLAYED:'displayed',DISPLAY_ERROR:'displayerror',RENDERED:'rendered',REMOVED:'removed',RESIZED:'resized',ORIENTATION_CHANGE:'orientationchange',LOCATION_CHANGED:'locationChanged',RELOCATED:'relocated',MARK_CLICKED:'markClicked',SELECTED:'selected',LAYOUT:'layout'},LAYOUT:{UPDATED:'updated'}}}])});