(function(g,k){'object'==typeof exports&&'object'==typeof module?module.exports=k(require('xmldom')):'function'==typeof define&&define.amd?define(['xmldom'],k):'object'==typeof exports?exports.EPUBJSContents=k(require('xmldom')):g.EPUBJSContents=k(g.xmldom)})(this,function(f){return function(g){function k(s){if(p[s])return p[s].exports;var t=p[s]={exports:{},id:s,loaded:!1};return g[s].call(t.exports,t,t.exports,k),t.loaded=!0,t.exports}var p={};return k.m=g,k.c=p,k.p='',k(0)}([function(g,k,p){var s=p(1);g.exports=s},function(g,k,p){'use strict';function s(C){return C&&C.__esModule?C:{default:C}}Object.defineProperty(k,'__esModule',{value:!0});var t=p(2),u=s(t),v=p(17),x=p(19),y=s(x),z=p(20),A=s(z);class B{constructor(C,D,E){this.epubcfi=new y.default,this.document=C,this.documentElement=this.document.documentElement,this.content=D||this.document.body,this.window=this.document.defaultView,this.listenedEvents=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],this._size={width:0,height:0},this.cfiBase=E||'',this.listeners()}width(C){var D=this.content;return C&&(0,v.isNumber)(C)&&(C=C+'px'),C&&(D.style.width=C),this.window.getComputedStyle(D).width}height(C){var D=this.content;return C&&(0,v.isNumber)(C)&&(C=C+'px'),C&&(D.style.height=C),this.window.getComputedStyle(D).height}contentWidth(C){var D=this.content||this.document.body;return C&&(0,v.isNumber)(C)&&(C=C+'px'),C&&(D.style.width=C),this.window.getComputedStyle(D).width}contentHeight(C){var D=this.content||this.document.body;return C&&(0,v.isNumber)(C)&&(C=C+'px'),C&&(D.style.height=C),this.window.getComputedStyle(D).height}textWidth(){var C,D=this.document.createRange(),E=this.content||this.document.body;return D.selectNodeContents(E),C=D.getBoundingClientRect().width,C}textHeight(){var C,D=this.document.createRange(),E=this.content||this.document.body;return D.selectNodeContents(E),C=D.getBoundingClientRect().height,C}scrollWidth(){var C=this.documentElement.scrollWidth;return C}scrollHeight(){var C=this.documentElement.scrollHeight;return C}overflow(C){return C&&(this.documentElement.style.overflow=C),this.window.getComputedStyle(this.documentElement).overflow}overflowX(C){return C&&(this.documentElement.style.overflowX=C),this.window.getComputedStyle(this.documentElement).overflowX}overflowY(C){return C&&(this.documentElement.style.overflowY=C),this.window.getComputedStyle(this.documentElement).overflowY}css(C,D){var E=this.content||this.document.body;return D&&(E.style[C]=D),this.window.getComputedStyle(E)[C]}viewport(C){var D,E,F,G,H=this.document.querySelector('meta[name=\'viewport\']'),I='';if(H&&H.hasAttribute('content')){var J=H.getAttribute('content'),K=J.split(/\s*,\s*/);K[0]&&(D=K[0].replace('width=','').trim()),K[1]&&(E=K[1].replace('height=','').trim()),K[2]&&(F=K[2].replace('initial-scale=','').trim()),K[3]&&(G=K[3].replace('user-scalable=','').trim())}return C&&(I+='width='+(C.width||D),I+=', height='+(C.height||E),(C.scale||F)&&(I+=', initial-scale='+(C.scale||F)),(C.scalable||G)&&(I+=', user-scalable='+(C.scalable||G)),!H&&(H=this.document.createElement('meta'),H.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(H)),H.setAttribute('content',I)),{width:parseInt(D),height:parseInt(E)}}expand(){this.emit('expand')}listeners(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners()}removeListeners(){this.removeEventListeners(),this.removeSelectionListeners()}resizeListeners(){var C,D;clearTimeout(this.expanding),C=this.scrollWidth(),D=this.scrollHeight(),(C!=this._size.width||D!=this._size.height)&&(this._size={width:C,height:D},this.emit('resize',this._size)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}mediaQueryListeners(){var C=this.document.styleSheets,D=function(I){I.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this);for(var E=0;E<C.length;E+=1){var F;try{F=C[E].cssRules}catch(I){return}if(!F)return;for(var G=0;G<F.length;G+=1)if(F[G].media){var H=this.window.matchMedia(F[G].media.mediaText);H.addListener(D)}}}observe(C){var D=this,E=new MutationObserver(function(){D._expanding&&D.expand()});return E.observe(C,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),E}imageLoadListeners(){var C=this.document.querySelectorAll('img'),D;for(var E=0;E<C.length;E++)D=C[E],'undefined'!=typeof D.naturalWidth&&0===D.naturalWidth&&(D.onload=this.expand.bind(this))}fontLoadListeners(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.expand()}.bind(this))}root(){return this.document?this.document.documentElement:null}locationOf(C,D){var E,F={left:0,top:0};if(this.document){if(this.epubcfi.isCfiString(C)){var G=new y.default(C).toRange(this.document,D);G&&(G.startContainer.nodeType===Node.ELEMENT_NODE?(E=G.startContainer.getBoundingClientRect(),F.left=E.left,F.top=E.top):(E=G.collapsed?G.getClientRects()[0]:G.getBoundingClientRect(),F.left=E.left,F.top=E.top))}else if('string'==typeof C&&-1<C.indexOf('#')){var H=C.substring(C.indexOf('#')+1),I=this.document.getElementById(H);I&&(E=I.getBoundingClientRect(),F.left=E.left,F.top=E.top)}return F}}addStylesheet(C){return new Promise(function(D){var E,F=!1;return this.document?(E=this.document.querySelector('link[href=\''+C+'\']'),E?void D(!0):void(E=this.document.createElement('link'),E.type='text/css',E.rel='stylesheet',E.href=C,E.onload=E.onreadystatechange=function(){F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){D(!0)},1))},this.document.head.appendChild(E))):void D(!1)}.bind(this))}addStylesheetRules(C){var D,E,F='epubjs-inserted-css';if(this.document){D=this.document.getElementById('#'+F),D||(D=this.document.createElement('style'),D.id=F),this.document.head.appendChild(D),E=D.sheet;for(var G=0,H=C.length;G<H;G++){var I=1,J=C[G],K=C[G][0],L='';'[object Array]'===Object.prototype.toString.call(J[1][0])&&(J=J[1],I=0);for(var M=J.length;I<M;I++){var N=J[I];L+=N[0]+':'+N[1]+(N[2]?' !important':'')+';\n'}E.insertRule(K+'{'+L+'}',E.cssRules.length)}}}addScript(C){return new Promise(function(D){var E,F=!1;return this.document?void(E=this.document.createElement('script'),E.type='text/javascript',E.async=!0,E.src=C,E.onload=E.onreadystatechange=function(){F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){D(!0)},1))},this.document.head.appendChild(E)):void D(!1)}.bind(this))}addClass(C){var D;this.document&&(D=this.content||this.document.body,D.classList.add(C))}removeClass(C){var D;this.document&&(D=this.content||this.document.body,D.classList.remove(C))}addEventListeners(){this.document&&this.listenedEvents.forEach(function(C){this.document.addEventListener(C,this.triggerEvent.bind(this),!1)},this)}removeEventListeners(){this.document&&this.listenedEvents.forEach(function(C){this.document.removeEventListener(C,this.triggerEvent,!1)},this)}triggerEvent(C){this.emit(C.type,C)}addSelectionListeners(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}removeSelectionListeners(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}onSelectionChange(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var C=this.window.getSelection();this.triggerSelectedEvent(C)}.bind(this),500)}triggerSelectedEvent(C){var D,E;C&&0<C.rangeCount&&(D=C.getRangeAt(0),!D.collapsed&&(E=new y.default(D,this.cfiBase).toString(),this.emit('selected',E),this.emit('selectedRange',D)))}range(C,D){var E=new y.default(C);return E.toRange(this.document,D)}map(C){var D=new A.default(C);return D.section()}size(C,D){0<=C&&this.width(C),0<=D&&this.height(D),this.css('margin','0'),this.css('boxSizing','border-box')}columns(C,D,E,F){var G=(0,v.prefixed)('columnAxis'),H=(0,v.prefixed)('columnGap'),I=(0,v.prefixed)('columnWidth'),J=(0,v.prefixed)('columnFill');this.width(C),this.height(D),this.viewport({width:C,height:D,scale:1}),this.css('overflowY','hidden'),this.css('margin','0'),this.css('boxSizing','border-box'),this.css('maxWidth','inherit'),this.css(G,'horizontal'),this.css(J,'auto'),this.css(H,F+'px'),this.css(I,E+'px')}scaler(C,D,E){var F='';this.css('transformOrigin','top left'),(0<=D||0<=E)&&(F=' translate('+(D||0)+'px, '+(E||0)+'px )'),this.css('transform','scale('+C+')'+F)}fit(C,D){var E=this.viewport(),F=C/E.width,G=D/E.height,H=F<G?F:G,I=(D-E.height*H)/2;this.width(C),this.height(D),this.overflow('hidden'),this.viewport({scale:1}),this.scaler(H,0,I),this.css('backgroundColor','transparent')}mapPage(C,D,E){var F=new A.default;return F.page(this,C,D,E)}destroy(){this.observer&&this.observer.disconnect(),this.removeListeners()}}(0,u.default)(B.prototype),k.default=B,g.exports=k['default']},function(g,k,p){'use strict';var C,D,E,F,G,H,I,s=p(3),t=p(16),u=Function.prototype.apply,v=Function.prototype.call,x=Object.create,y=Object.defineProperty,z=Object.defineProperties,A=Object.prototype.hasOwnProperty,B={configurable:!0,enumerable:!1,writable:!0};C=function(J,K){var L;return t(K),A.call(this,'__ee__')?L=this.__ee__:(L=B.value=x(null),y(this,'__ee__',B),B.value=null),L[J]?'object'==typeof L[J]?L[J].push(K):L[J]=[L[J],K]:L[J]=K,this},D=function(J,K){var L,M;return t(K),M=this,C.call(this,J,L=function(){E.call(M,J,L),u.call(K,this,arguments)}),L.__eeOnceListener__=K,this},E=function(J,K){var L,M,N,O;if(t(K),!A.call(this,'__ee__'))return this;if(L=this.__ee__,!L[J])return this;if(M=L[J],'object'==typeof M)for(O=0;N=M[O];++O)(N===K||N.__eeOnceListener__===K)&&(2===M.length?L[J]=M[O?0:1]:M.splice(O,1));else(M===K||M.__eeOnceListener__===K)&&delete L[J];return this},F=function(J){var K,L,M,N,O;if(A.call(this,'__ee__')&&(N=this.__ee__[J],N))if('object'==typeof N){for(L=arguments.length,O=Array(L-1),K=1;K<L;++K)O[K-1]=arguments[K];for(N=N.slice(),K=0;M=N[K];++K)u.call(M,this,O)}else switch(arguments.length){case 1:v.call(N,this);break;case 2:v.call(N,this,arguments[1]);break;case 3:v.call(N,this,arguments[1],arguments[2]);break;default:for(L=arguments.length,O=Array(L-1),K=1;K<L;++K)O[K-1]=arguments[K];u.call(N,this,O);}},G={on:C,once:D,off:E,emit:F},H={on:s(C),once:s(D),off:s(E),emit:s(F)},I=z({},H),g.exports=k=function(J){return null==J?x(I):z(Object(J),H)},k.methods=G},function(g,k,p){'use strict';var x,s=p(4),t=p(11),u=p(12),v=p(13);x=g.exports=function(y,z){var A,B,C,D,E;return 2>arguments.length||'string'!=typeof y?(D=z,z=y,y=null):D=arguments[2],null==y?(A=C=!0,B=!1):(A=v.call(y,'c'),B=v.call(y,'e'),C=v.call(y,'w')),E={value:z,configurable:A,enumerable:B,writable:C},D?s(t(D),E):E},x.gs=function(y,z,A){var B,C,D,E;return'string'==typeof y?D=arguments[3]:(D=A,A=z,z=y,y=null),null==z?z=void 0:u(z)?null==A?A=void 0:!u(A)&&(D=A,A=void 0):(D=z,z=A=void 0),null==y?(B=!0,C=!1):(B=v.call(y,'c'),C=v.call(y,'e')),E={get:z,set:A,configurable:B,enumerable:C},D?s(t(D),E):E}},function(g,k,p){'use strict';g.exports=p(5)()?Object.assign:p(6)},function(g){'use strict';g.exports=function(){var p,k=Object.assign;return!('function'!=typeof k)&&(p={foo:'raz'},k(p,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===p.foo+p.bar+p.trzy)}},function(g,k,p){'use strict';var s=p(7),t=p(10),u=Math.max;g.exports=function(v,x){var y,z,B,A=u(arguments.length,2);for(v=Object(t(v)),B=function(C){try{v[C]=x[C]}catch(D){y||(y=D)}},z=1;z<A;++z)x=arguments[z],s(x).forEach(B);if(y!==void 0)throw y;return v}},function(g,k,p){'use strict';g.exports=p(8)()?Object.keys:p(9)},function(g){'use strict';g.exports=function(){try{return Object.keys('primitive'),!0}catch(k){return!1}}},function(g){'use strict';var k=Object.keys;g.exports=function(p){return k(null==p?p:Object(p))}},function(g){'use strict';g.exports=function(k){if(null==k)throw new TypeError('Cannot use null or undefined');return k}},function(g){'use strict';var k=Array.prototype.forEach,p=Object.create,s=function(t,u){for(var v in t)u[v]=t[v]};g.exports=function(){var t=p(null);return k.call(arguments,function(u){null==u||s(Object(u),t)}),t}},function(g){'use strict';g.exports=function(k){return'function'==typeof k}},function(g,k,p){'use strict';g.exports=p(14)()?String.prototype.contains:p(15)},function(g){'use strict';var k='razdwatrzy';g.exports=function(){return!('function'!=typeof k.contains)&&!0===k.contains('dwa')&&!1===k.contains('foo')}},function(g){'use strict';var k=String.prototype.indexOf;g.exports=function(p){return-1<k.call(this,p,arguments[1])}},function(g){'use strict';g.exports=function(k){if('function'!=typeof k)throw new TypeError(k+' is not a function');return k}},function(g,k,p){'use strict';function s(){var A=new Date().getTime(),B='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(C){var D=0|(A+16*Math.random())%16;return A=Math.floor(A/16),('x'==C?D:8|7&D).toString(16)});return B}function t(A){return!isNaN(parseFloat(A))&&isFinite(A)}function u(A,B,C,D,E){var I,F=D||0,G=E||B.length,H=parseInt(F+(G-F)/2);return(C||(C=function(K,L){return K>L?1:K<L?-1:K==L?0:void 0}),0>=G-F)?H:(I=C(B[H],A),1==G-F?0<I?H:H+1:0===I?H:-1===I?u(A,B,C,H,G):u(A,B,C,F,H))}function v(A,B,C,D,E){var I,F=D||0,G=E||B.length,H=parseInt(F+(G-F)/2);return(C||(C=function(K,L){return K>L?1:K<L?-1:K==L?0:void 0}),0>=G-F)?-1:(I=C(B[H],A),1==G-F?0===I?H:-1:0===I?H:-1===I?v(A,B,C,H,G):v(A,B,C,F,H))}function x(A,B){return'undefined'==typeof A.querySelector?A.getElementsByTagName(B):A.querySelectorAll(B)}function y(A,B,C){for(var D=document.createTreeWalker(A,C,null,!1),E=void 0;E=D.nextNode();)B(E)}function z(A,B){if(B(A))return!0;if(A=A.firstChild,A)do{var C=z(A,B);if(C)return!0;A=A.nextSibling}while(A)}Object.defineProperty(k,'__esModule',{value:!0}),k.isElement=function(B){return!!(B&&1==B.nodeType)},k.uuid=s,k.documentHeight=function(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},k.isNumber=t,k.isFloat=function(B){return t(B)&&Math.floor(B)!==B},k.prefixed=function(B){var C=['Webkit','Moz','O','ms'],D=B[0].toUpperCase()+B.slice(1),E=C.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[B])return B;for(var F=0;F<E;F++)if('undefined'!=typeof document.body.style[C[F]+D])return C[F]+D;return B},k.defaults=function(B){for(var C=1,D=arguments.length;C<D;C++){var E=arguments[C];for(var F in E)void 0===B[F]&&(B[F]=E[F])}return B},k.extend=function(B){var C=[].slice.call(arguments,1);return C.forEach(function(D){D&&Object.getOwnPropertyNames(D).forEach(function(E){Object.defineProperty(B,E,Object.getOwnPropertyDescriptor(D,E))})}),B},k.insert=function(B,C,D){var E=u(B,C,D);return C.splice(E,0,B),E},k.locationOf=u,k.indexOfSorted=v,k.bounds=function(B){var C=window.getComputedStyle(B),D=0,E=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(F){D+=parseFloat(C[F])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(F){E+=parseFloat(C[F])||0}),{height:E,width:D}},k.borders=function(B){var C=window.getComputedStyle(B),D=0,E=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(F){D+=parseFloat(C[F])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(F){E+=parseFloat(C[F])||0}),{height:E,width:D}},k.windowBounds=function(){var B=window.innerWidth,C=window.innerHeight;return{top:0,left:0,right:B,bottom:C,width:B,height:C}},k.cleanStringForXpath=function(B){var C=B.match(/[^'"]+|['"]/g);return C=C.map(function(D){return'\''===D?'"\'"':'"'===D?'\'"\'':`\'${D}\'`}),`concat(\'\',${C.join(',')})`},k.indexOfTextNode=function(B){var C=B.parentNode,D=C.childNodes,E,F=-1;for(var G=0;G<D.length&&(E=D[G],E.nodeType===Node.TEXT_NODE&&F++,E!=B);G++);return F},k.isXml=function(B){return-1<['xml','opf','ncx'].indexOf(B)},k.createBlob=function(B,C){return new Blob([B],{type:C})},k.createBlobUrl=function(B,C){var E,D=window.URL||window.webkitURL||window.mozURL,F=this.createBlob(B,C);return E=D.createObjectURL(F),E},k.createBase64Url=function(B,C){var D,E;if('string'==typeof B)return D=btoa(B),E='data:'+C+';base64,'+D,E},k.type=function(B){return Object.prototype.toString.call(B).slice(8,-1)},k.parse=function(B,C,D){var E,F;return F='undefined'==typeof DOMParser||D?p(18).DOMParser:DOMParser,E=new F().parseFromString(B,C),E},k.qs=function(B,C){var D;if(!B)throw new Error('No Element Provided');return'undefined'==typeof B.querySelector?(D=B.getElementsByTagName(C),D.length)?D[0]:void 0:B.querySelector(C)},k.qsa=x,k.qsp=function(B,C,D){var E,F;if('undefined'!=typeof B.querySelector){for(var G in C+='[',D)C+=G+'=\''+D[G]+'\'';return C+=']',B.querySelector(C)}return(E=B.getElementsByTagName(C),F=Array.prototype.slice.call(E,0).filter(function(H){for(var I in D)if(H.getAttribute(I)===D[I])return!0;return!1}),F)?F[0]:void 0},k.sprint=function(B,C){var D=B.ownerDocument||B;'undefined'==typeof D.createTreeWalker?z(B,function(E){E&&3===E.nodeType&&C(E)},!0):y(B,C,NodeFilter.SHOW_TEXT)},k.treeWalker=y,k.walk=z,k.blob2base64=function(B,C){var D=new FileReader;D.readAsDataURL(B),D.onloadend=function(){C(D.result)}},k.defer=function(){this.resolve=null,this.reject=null,this.id=s(),this.promise=new Promise((B,C)=>{this.resolve=B,this.reject=C}),Object.freeze(this)},k.querySelectorByType=function(B,C,D){var E;if('undefined'!=typeof B.querySelector&&(E=B.querySelector(`${C}[*|type="${D}"]`)),!E||0===E.length){E=x(B,C);for(var F=0;F<E.length;F++)if(E[F].getAttributeNS('http://www.idpf.org/2007/ops','type')===D)return E[F]}else return E},k.findChildren=function(B){var C=[],D=B.parentNode.childNodes;for(var E=0;E<D.length;E++){var F=D[E];1===F.nodeType&&C.push(F)}return C},k.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame)},function(g){g.exports=f},function(g,k,p){'use strict';Object.defineProperty(k,'__esModule',{value:!0});var s=p(17),t=1,u=3;class v{constructor(x,y,z){var A;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof v))return new v(x,y,z);if('string'==typeof y?this.base=this.parseComponent(y):'object'==typeof y&&y.steps&&(this.base=y),A=this.checkType(x),'string'===A)return this.str=x,(0,s.extend)(this,this.parse(x));if('range'===A)return(0,s.extend)(this,this.fromRange(x,this.base,z));if('node'===A)return(0,s.extend)(this,this.fromNode(x,this.base,z));if('EpubCFI'===A&&x.path)return x;if(!x)return this;throw new TypeError('not a valid argument for EpubCFI')}checkType(x){if(this.isCfiString(x))return'string';return'object'==typeof x&&('Range'===(0,s.type)(x)||'undefined'!=typeof x.startContainer)?'range':'object'==typeof x&&'undefined'!=typeof x.nodeType?'node':'object'==typeof x&&x instanceof v&&'EpubCFI'}parse(x){var z,A,B,y={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return'string'==typeof x?(0===x.indexOf('epubcfi(')&&')'===x[x.length-1]&&(x=x.slice(8,x.length-1)),z=this.getChapterComponent(x),!z)?{spinePos:-1}:(y.base=this.parseComponent(z),A=this.getPathComponent(x),y.path=this.parseComponent(A),B=this.getRange(x),B&&(y.range=!0,y.start=this.parseComponent(B[0]),y.end=this.parseComponent(B[1])),y.spinePos=y.base.steps[1].index,y):{spinePos:-1}}parseComponent(x){var B,y={steps:[],terminal:{offset:null,assertion:null}},z=x.split(':'),A=z[0].split('/');return 1<z.length&&(B=z[1],y.terminal=this.parseTerminal(B)),''===A[0]&&A.shift(),y.steps=A.map(function(C){return this.parseStep(C)}.bind(this)),y}parseStep(x){var y,z,A,B,C;if(B=x.match(/\[(.*)\]/),B&&B[1]&&(C=B[1]),z=parseInt(x),!isNaN(z))return 0==z%2?(y='element',A=z/2-1):(y='text',A=(z-1)/2),{type:y,index:A,id:C||null}}parseTerminal(x){var y,z,A=x.match(/\[(.*)\]/);return A&&A[1]?(y=parseInt(x.split('[')[0])||null,z=A[1]):y=parseInt(x)||null,{offset:y,assertion:z}}getChapterComponent(x){var y=x.split('!');return y[0]}getPathComponent(x){var y=x.split('!');if(y[1]){var z=y[1].split(',');return z[0]}}getRange(x){var y=x.split(',');return!(3!==y.length)&&[y[1],y[2]]}getCharecterOffsetComponent(x){var y=x.split(':');return y[1]||''}joinSteps(x){return x?x.map(function(y){var z='';return'element'===y.type&&(z+=2*(y.index+1)),'text'===y.type&&(z+=1+2*y.index),y.id&&(z+='['+y.id+']'),z}).join('/'):''}segmentString(x){var y='/';return y+=this.joinSteps(x.steps),x.terminal&&null!=x.terminal.offset&&(y+=':'+x.terminal.offset),x.terminal&&null!=x.terminal.assertion&&(y+='['+x.terminal.assertion+']'),y}toString(){var x='epubcfi(';return x+=this.segmentString(this.base),x+='!',x+=this.segmentString(this.path),this.start&&(x+=',',x+=this.segmentString(this.start)),this.end&&(x+=',',x+=this.segmentString(this.end)),x+=')',x}compare(x,y){var z,A,B,C;if('string'==typeof x&&(x=new v(x)),'string'==typeof y&&(y=new v(y)),x.spinePos>y.spinePos)return 1;if(x.spinePos<y.spinePos)return-1;x.range?(z=x.path.steps.concat(x.start.steps),B=x.start.terminal):(z=x.path.steps,B=x.path.terminal),y.range?(A=y.path.steps.concat(y.start.steps),C=y.start.terminal):(A=y.path.steps,C=y.path.terminal);for(var D=0;D<z.length;D++){if(!z[D])return-1;if(!A[D])return 1;if(z[D].index>A[D].index)return 1;if(z[D].index<A[D].index)return-1}return z.length<A.length?1:B.offset>C.offset?1:B.offset<C.offset?-1:0}step(x){var y=x.nodeType===u?'text':'element';return{id:x.id,tagName:x.tagName,type:y,index:this.position(x)}}filteredStep(x,y){var A,z=this.filter(x,y);if(z)return A=z.nodeType===u?'text':'element',{id:z.id,tagName:z.tagName,type:A,index:this.filteredPosition(z,y)}}pathTo(x,y,z){for(var C,A={steps:[],terminal:{offset:null,assertion:null}},B=x;B&&B.parentNode&&9!=B.parentNode.nodeType;)C=z?this.filteredStep(B,z):this.step(B),C&&A.steps.unshift(C),B=B.parentNode;return null!=y&&0<=y&&(A.terminal.offset=y,'text'!=A.steps[A.steps.length-1].type&&A.steps.push({type:'text',index:0})),A}equalStep(x,y){return x&&y&&x.index===y.index&&x.id===y.id&&x.type===y.type}fromRange(x,y,z){var A={range:!1,base:{},path:{},start:null,end:null},B=x.startContainer,C=x.endContainer,D=x.startOffset,E=x.endOffset,F=!1;if(z&&(F=null!=B.ownerDocument.querySelector('.'+z)),'string'==typeof y?(A.base=this.parseComponent(y),A.spinePos=A.base.steps[1].index):'object'==typeof y&&(A.base=y),x.collapsed)F&&(D=this.patchOffset(B,D,z)),A.path=this.pathTo(B,D,z);else{A.range=!0,F&&(D=this.patchOffset(B,D,z)),A.start=this.pathTo(B,D,z),F&&(E=this.patchOffset(C,E,z)),A.end=this.pathTo(C,E,z),A.path={steps:[],terminal:null};var H,G=A.start.steps.length;for(H=0;H<G&&this.equalStep(A.start.steps[H],A.end.steps[H]);H++)H===G-1?A.start.terminal===A.end.terminal&&(A.path.steps.push(A.start.steps[H]),A.range=!1):A.path.steps.push(A.start.steps[H]);A.start.steps=A.start.steps.slice(A.path.steps.length),A.end.steps=A.end.steps.slice(A.path.steps.length)}return A}fromNode(x,y,z){var A={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof y?(A.base=this.parseComponent(y),A.spinePos=A.base.steps[1].index):'object'==typeof y&&(A.base=y),A.path=this.pathTo(x,null,z),A}filter(x,y){var z,A,B,C,D,E=!1;return(x.nodeType===u?(E=!0,B=x.parentNode,z=x.parentNode.classList.contains(y)):(E=!1,z=x.classList.contains(y)),z&&E)?(C=B.previousSibling,D=B.nextSibling,C&&C.nodeType===u?A=C:D&&D.nodeType===u&&(A=D),A)?A:x:z&&!E?!1:x}patchOffset(x,y,z){if(x.nodeType!=u)throw new Error('Anchor must be a text node');var A=x,B=y;for(x.parentNode.classList.contains(z)&&(A=x.parentNode);A.previousSibling;){if(!(A.previousSibling.nodeType===t))B+=A.previousSibling.textContent.length;else if(A.previousSibling.classList.contains(z))B+=A.previousSibling.textContent.length;else break;A=A.previousSibling}return B}normalizedMap(x,y,z){var A={},B=-1,C,D=x.length,E,F;for(C=0;C<D;C++)E=x[C].nodeType,E===t&&x[C].classList.contains(z)&&(E=u),0<C&&E===u&&F===u?A[C]=B:y===E&&(B=B+1,A[C]=B),F=E;return A}position(x){var y,z;return x.nodeType===t?(y=x.parentNode.children,!y&&(y=(0,s.findChildren)(x.parentNode)),z=Array.prototype.indexOf.call(y,x)):(y=this.textNodes(x.parentNode),z=y.indexOf(x)),z}filteredPosition(x,y){var z,A,B;return x.nodeType===t?(z=x.parentNode.children,B=this.normalizedMap(z,t,y)):(z=x.parentNode.childNodes,x.parentNode.classList.contains(y)&&(x=x.parentNode,z=x.parentNode.childNodes),B=this.normalizedMap(z,u,y)),A=Array.prototype.indexOf.call(z,x),B[A]}stepsToXpath(x){var y=['.','*'];return x.forEach(function(z){var A=z.index+1;z.id?y.push('*[position()='+A+' and @id=\''+z.id+'\']'):'text'===z.type?y.push('text()['+A+']'):y.push('*['+A+']')}),y.join('/')}stepsToQuerySelector(x){var y=['html'];return x.forEach(function(z){var A=z.index+1;z.id?y.push('#'+z.id):'text'!==z.type&&y.push('*:nth-child('+A+')')}),y.join('>')}textNodes(x,y){return Array.prototype.slice.call(x.childNodes).filter(function(z){if(z.nodeType===u)return!0;return y&&z.classList.contains(y)})}walkToNode(x,y,z){var A=y||document,B=A.documentElement,C,D=x.length,E;for(E=0;E<D;E++)C=x[E],'element'===C.type?B=B.children[C.index]:'text'===C.type&&(B=this.textNodes(B,z)[C.index]);return B}findNode(x,y,z){var B,C,A=y||document;return z||'undefined'==typeof A.evaluate?z?B=this.walkToNode(x,A,z):B=this.walkToNode(x,A):(C=this.stepsToXpath(x),B=A.evaluate(C,A,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),B}fixMiss(x,y,z,A){var B=this.findNode(x.slice(0,-1),z,A),C=B.childNodes,D=this.normalizedMap(C,u,A),E,F,G=x[x.length-1].index;for(var H in D){if(!D.hasOwnProperty(H))return;if(D[H]===G)if(E=C[H],F=E.textContent.length,y>F)y=y-F;else{B=E.nodeType===t?E.childNodes[0]:E;break}}return{container:B,offset:y}}toRange(x,y){var B,C,D,E,G,H,J,z=x||document,A=z.createRange(),F=this,I=!!y&&null!=z.querySelector('.'+y);if(F.range?(B=F.start,G=F.path.steps.concat(B.steps),D=this.findNode(G,z,I?y:null),C=F.end,H=F.path.steps.concat(C.steps),E=this.findNode(H,z,I?y:null)):(B=F.path,G=F.path.steps,D=this.findNode(F.path.steps,z,I?y:null)),D)try{null==B.terminal.offset?A.setStart(D,0):A.setStart(D,B.terminal.offset)}catch(K){J=this.fixMiss(G,B.terminal.offset,z,I?y:null),A.setStart(J.container,J.offset)}else return null;if(E)try{null==C.terminal.offset?A.setEnd(E,0):A.setEnd(E,C.terminal.offset)}catch(K){J=this.fixMiss(H,F.end.terminal.offset,z,I?y:null),A.setEnd(J.container,J.offset)}return A}isCfiString(x){return'string'==typeof x&&0===x.indexOf('epubcfi(')&&')'===x[x.length-1]}generateChapterComponent(x,y,z){var A=parseInt(y),B='/'+(x+1)+'/';return B+=2*(A+1),z&&(B+='['+z+']'),B}}k.default=v,g.exports=k['default']},function(g,k,p){'use strict';Object.defineProperty(k,'__esModule',{value:!0});var s=p(19),t=function(v){return v&&v.__esModule?v:{default:v}}(s);k.default=class{constructor(v){this.layout=v}section(v){var x=this.findRanges(v),y=this.rangeListToCfiList(v.section.cfiBase,x);return y}page(v,x,y,z){var A=v&&v.document&&v.document.body;return A?this.rangePairToCfiPair(x,{start:this.findStart(A,y,z),end:this.findEnd(A,y,z)}):void 0}walk(v,x){for(var z,A,y=document.createTreeWalker(v,NodeFilter.SHOW_TEXT,{acceptNode:function(C){return 0<C.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);(z=y.nextNode())&&(A=x(z),!A););return A}findRanges(v){var x=[],y=v.contents.scrollWidth(),z=this.layout.count(y),A=this.layout.column,B=this.layout.gap,C,D;for(var E=0;E<z.pages;E++)C=(A+B)*E,D=A*(E+1)+B*E,x.push({start:this.findStart(v.document.body,C,D),end:this.findEnd(v.document.body,C,D)});return x}findStart(v,x,y){for(var A,B,z=[v],C=v;z.length;)if(A=z.shift(),B=this.walk(A,function(D){var E,F,G,H;return(D.nodeType==Node.TEXT_NODE?(H=document.createRange(),H.selectNodeContents(D),G=H.getBoundingClientRect()):G=D.getBoundingClientRect(),E=G.left,F=G.right,E>=x&&E<=y)?D:F>x?D:void(C=D,z.push(D))}),B)return this.findTextStartRange(B,x,y);return this.findTextStartRange(C,x,y)}findEnd(v,x,y){for(var A,C,z=[v],B=v;z.length;)if(A=z.shift(),C=this.walk(A,function(D){var E,F,G,H;return(D.nodeType==Node.TEXT_NODE?(H=document.createRange(),H.selectNodeContents(D),G=H.getBoundingClientRect()):G=D.getBoundingClientRect(),E=G.left,F=G.right,E>y&&B)?B:F>y?D:void(B=D,z.push(D))}),C)return this.findTextEndRange(C,x,y);return this.findTextEndRange(B,x,y)}findTextStartRange(v,x){var y=this.splitTextNodeIntoRanges(v),z,A;for(var B=0;B<y.length;B++)if(z=y[B],A=z.getBoundingClientRect(),A.left>=x)return z;return y[0]}findTextEndRange(v,x,y){var z=this.splitTextNodeIntoRanges(v),A,B,C;for(var D=0;D<z.length;D++){if(B=z[D],C=B.getBoundingClientRect(),C.left>y&&A)return A;if(C.right>y)return B;A=B}return z[z.length-1]}splitTextNodeIntoRanges(v,x){var B,y=[],z=v.textContent||'',A=z.trim(),C=v.ownerDocument,D=x||' ',E=A.indexOf(D);if(-1===E||v.nodeType!=Node.TEXT_NODE)return B=C.createRange(),B.selectNodeContents(v),[B];for(B=C.createRange(),B.setStart(v,0),B.setEnd(v,E),y.push(B),B=!1;-1!=E;)E=A.indexOf(D,E+1),0<E&&(B&&(B.setEnd(v,E),y.push(B)),B=C.createRange(),B.setStart(v,E+1));return B&&(B.setEnd(v,A.length),y.push(B)),y}rangePairToCfiPair(v,x){var y=x.start,z=x.end;y.collapse(!0),z.collapse(!0);var A=new t.default(y,v).toString(),B=new t.default(z,v).toString();return{start:A,end:B}}rangeListToCfiList(v,x){var y=[],z;for(var A=0;A<x.length;A++)z=this.rangePairToCfiPair(v,x[A]),y.push(z);return y}},g.exports=k['default']}])});