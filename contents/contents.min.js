var _Stringprototype=String.prototype,_Mathmax=Math.max,_Mathfloor=Math.floor;(function(u,p){'object'==typeof exports&&'object'==typeof module?module.exports=p(require('xmldom')):'function'==typeof define&&define.amd?define(['xmldom'],p):'object'==typeof exports?exports.EPUBJSContents=p(require('xmldom')):u.EPUBJSContents=p(u.xmldom)})(this,function(s){return function(u){function p(v){if(f[v])return f[v].exports;var k=f[v]={i:v,l:!1,exports:{}};return u[v].call(k.exports,k,k.exports,p),k.l=!0,k.exports}var f={};return p.m=u,p.c=f,p.i=function(v){return v},p.d=function(v,k,C){p.o(v,k)||Object.defineProperty(v,k,{configurable:!1,enumerable:!0,get:C})},p.n=function(v){var k=v&&v.__esModule?function(){return v['default']}:function(){return v};return p.d(k,'a',k),k},p.o=function(v,k){return Object.prototype.hasOwnProperty.call(v,k)},p.p='',p(p.s=4)}([function(u,p,f){'use strict';function v(pe,fe){if(!(pe instanceof fe))throw new TypeError('Cannot call a class as a function')}function C(){var pe=new Date().getTime(),fe='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(he){var ge=0|(pe+16*Math.random())%16;return pe=_Mathfloor(pe/16),('x'==he?ge:8|7&ge).toString(16)});return fe}function S(pe){return!isNaN(parseFloat(pe))&&isFinite(pe)}function P(pe,fe,he,ge,me){var xe,ye=ge||0,be=me||fe.length,ve=parseInt(ye+(be-ye)/2);return(he||(he=function(Ce,we){return Ce>we?1:Ce<we?-1:Ce==we?0:void 0}),0>=be-ye)?ve:(xe=he(fe[ve],pe),1==be-ye?0<xe?ve:ve+1:0===xe?ve:-1===xe?P(pe,fe,he,ve,be):P(pe,fe,he,ye,ve))}function O(pe,fe,he,ge,me){var xe,ye=ge||0,be=me||fe.length,ve=parseInt(ye+(be-ye)/2);return(he||(he=function(Ce,we){return Ce>we?1:Ce<we?-1:Ce==we?0:void 0}),0>=be-ye)?-1:(xe=he(fe[ve],pe),1==be-ye?0===xe?ve:-1:0===xe?ve:-1===xe?O(pe,fe,he,ve,be):O(pe,fe,he,ye,ve))}function W(pe,fe){for(var me,he=pe.parentNode,ge=he.childNodes,ye=-1,be=0;be<ge.length&&(me=ge[be],me.nodeType===fe&&ye++,me!=pe);be++);return ye}function J(pe,fe){return'undefined'==typeof pe.querySelector?pe.getElementsByTagName(fe):pe.querySelectorAll(fe)}function Z(pe,fe,he){for(var me,ge=document.createTreeWalker(pe,he,null,!1);me=ge.nextNode();)fe(me)}function $(pe,fe){if(fe(pe))return!0;if(pe=pe.firstChild,pe)do{var he=$(pe,fe);if(he)return!0;pe=pe.nextSibling}while(pe)}function ie(pe){for(var fe=[pe];pe;pe=pe.parentNode)fe.unshift(pe);return fe}Object.defineProperty(p,'__esModule',{value:!0});var le=function(){function pe(fe,he){for(var me,ge=0;ge<he.length;ge++)me=he[ge],me.enumerable=me.enumerable||!1,me.configurable=!0,'value'in me&&(me.writable=!0),Object.defineProperty(fe,me.key,me)}return function(fe,he,ge){return he&&pe(fe.prototype,he),ge&&pe(fe,ge),fe}}();p.isElement=function(pe){return!!(pe&&1==pe.nodeType)},p.uuid=C,p.documentHeight=function(){return _Mathmax(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},p.isNumber=S,p.isFloat=function(pe){return S(pe)&&_Mathfloor(pe)!==pe},p.prefixed=function(pe){var fe=['-Webkit-','-moz-','-o-','-ms-'],he=pe[0].toUpperCase()+pe.slice(1),ge=fe.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[pe])return pe;for(var me=0;me<ge;me++)if('undefined'!=typeof document.body.style[fe[me]+he])return fe[me]+he;return pe},p.defaults=function(pe){for(var ge,fe=1,he=arguments.length;fe<he;fe++)for(var me in ge=arguments[fe],ge)void 0===pe[me]&&(pe[me]=ge[me]);return pe},p.extend=function(pe){var fe=[].slice.call(arguments,1);return fe.forEach(function(he){he&&Object.getOwnPropertyNames(he).forEach(function(ge){Object.defineProperty(pe,ge,Object.getOwnPropertyDescriptor(he,ge))})}),pe},p.insert=function(pe,fe,he){var ge=P(pe,fe,he);return fe.splice(ge,0,pe),ge},p.locationOf=P,p.indexOfSorted=O,p.bounds=function(pe){var fe=window.getComputedStyle(pe),me=0,ye=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(be){me+=parseFloat(fe[be])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(be){ye+=parseFloat(fe[be])||0}),{height:ye,width:me}},p.borders=function(pe){var fe=window.getComputedStyle(pe),me=0,ye=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(be){me+=parseFloat(fe[be])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(be){ye+=parseFloat(fe[be])||0}),{height:ye,width:me}},p.windowBounds=function(){var pe=window.innerWidth,fe=window.innerHeight;return{top:0,left:0,right:pe,bottom:fe,width:pe,height:fe}},p.cleanStringForXpath=function(pe){var fe=pe.match(/[^'"]+|['"]/g);return fe=fe.map(function(he){return'\''===he?'"\'"':'"'===he?'\'"\'':'\''+he+'\''}),'concat(\'\','+fe.join(',')+')'},p.indexOfNode=W,p.indexOfTextNode=function(pe){return W(pe,se)},p.indexOfElementNode=function(pe){return W(pe,re)},p.isXml=function(pe){return-1<['xml','opf','ncx'].indexOf(pe)},p.createBlob=function(pe,fe){return new Blob([pe],{type:fe})},p.createBlobUrl=function(pe,fe){var ge,he=window.URL||window.webkitURL||window.mozURL,me=this.createBlob(pe,fe);return ge=he.createObjectURL(me),ge},p.createBase64Url=function(pe,fe){var he,ge;if('string'==typeof pe)return he=btoa(pe),ge='data:'+fe+';base64,'+he,ge},p.type=function(pe){return Object.prototype.toString.call(pe).slice(8,-1)},p.parse=function(pe,fe,he){var ge,me;return me='undefined'==typeof DOMParser||he?f(27).DOMParser:DOMParser,65279===pe.charCodeAt(0)&&(pe=pe.slice(1)),ge=new me().parseFromString(pe,fe),ge},p.qs=function(pe,fe){var he;if(!pe)throw new Error('No Element Provided');return'undefined'==typeof pe.querySelector?(he=pe.getElementsByTagName(fe),he.length)?he[0]:void 0:pe.querySelector(fe)},p.qsa=J,p.qsp=function(pe,fe,he){var ge,me;if('undefined'!=typeof pe.querySelector){for(var ye in fe+='[',he)fe+=ye+'=\''+he[ye]+'\'';return fe+=']',pe.querySelector(fe)}return(ge=pe.getElementsByTagName(fe),me=Array.prototype.slice.call(ge,0).filter(function(be){for(var ve in he)if(be.getAttribute(ve)===he[ve])return!0;return!1}),me)?me[0]:void 0},p.sprint=function(pe,fe){var he=pe.ownerDocument||pe;'undefined'==typeof he.createTreeWalker?$(pe,function(ge){ge&&3===ge.nodeType&&fe(ge)},!0):Z(pe,fe,NodeFilter.SHOW_TEXT)},p.treeWalker=Z,p.walk=$,p.blob2base64=function(pe){return new Promise(function(fe){var ge=new FileReader;ge.readAsDataURL(pe),ge.onloadend=function(){fe(ge.result)}})},p.defer=function(){var pe=this;this.resolve=null,this.reject=null,this.id=C(),this.promise=new Promise(function(fe,he){pe.resolve=fe,pe.reject=he}),Object.freeze(this)},p.querySelectorByType=function(pe,fe,he){var ge;if('undefined'!=typeof pe.querySelector&&(ge=pe.querySelector(fe+'[*|type="'+he+'"]')),!ge||0===ge.length){ge=J(pe,fe);for(var me=0;me<ge.length;me++)if(ge[me].getAttributeNS('http://www.idpf.org/2007/ops','type')===he)return ge[me]}else return ge},p.findChildren=function(pe){for(var me,fe=[],he=pe.childNodes,ge=0;ge<he.length;ge++)me=he[ge],1===me.nodeType&&fe.push(me);return fe},p.parents=ie;var oe=p.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),re=1,se=3,ce=p.RangeObject=function(){function pe(){v(this,pe),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return le(pe,[{key:'setStart',value:function(he,ge){this.startContainer=he,this.startOffset=ge,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:'setEnd',value:function(he,ge){this.endContainer=he,this.endOffset=ge,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:'collapse',value:function(he){this.collapsed=!0,he?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:'selectNode',value:function(he){var ge=he.parentNode,me=Array.prototype.indexOf.call(ge.childNodes,he);this.setStart(ge,me),this.setEnd(ge,me+1)}},{key:'selectNodeContents',value:function(he){var ge=he.childNodes[he.childNodes-1],me=3===he.nodeType?he.textContent.length:parent.childNodes.length;this.setStart(he,0),this.setEnd(he,me)}},{key:'_commonAncestorContainer',value:function(he,ge){var me=ie(he||this.startContainer),ye=ie(ge||this.endContainer);if(me[0]==ye[0])for(var be=0;be<me.length;be++)if(me[be]!=ye[be])return me[be-1]}},{key:'_checkCollapsed',value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:'toString',value:function(){}}]),pe}()},function(u,p,f){'use strict';function v(N,A){if(!(N instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var k='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(N){return typeof N}:function(N){return N&&'function'==typeof Symbol&&N.constructor===Symbol&&N!==Symbol.prototype?'symbol':typeof N},C=function(){function N(A,P){for(var L,O=0;O<P.length;O++)L=P[O],L.enumerable=L.enumerable||!1,L.configurable=!0,'value'in L&&(L.writable=!0),Object.defineProperty(A,L.key,L)}return function(A,P,O){return P&&N(A.prototype,P),O&&N(A,O),A}}(),E=f(0),S=1,_=3,R=function(){function N(A,P,O){v(this,N);var L;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof N))return new N(A,P,O);if('string'==typeof P?this.base=this.parseComponent(P):'object'===('undefined'==typeof P?'undefined':k(P))&&P.steps&&(this.base=P),L=this.checkType(A),'string'===L)return this.str=A,(0,E.extend)(this,this.parse(A));if('range'===L)return(0,E.extend)(this,this.fromRange(A,this.base,O));if('node'===L)return(0,E.extend)(this,this.fromNode(A,this.base,O));if('EpubCFI'===L&&A.path)return A;if(!A)return this;throw new TypeError('not a valid argument for EpubCFI')}return C(N,[{key:'checkType',value:function(P){return this.isCfiString(P)?'string':'object'===('undefined'==typeof P?'undefined':k(P))&&('Range'===(0,E.type)(P)||'undefined'!=typeof P.startContainer)?'range':'object'===('undefined'==typeof P?'undefined':k(P))&&'undefined'!=typeof P.nodeType?'node':'object'===('undefined'==typeof P?'undefined':k(P))&&P instanceof N&&'EpubCFI'}},{key:'parse',value:function(P){var L,B,z,O={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return'string'==typeof P?(0===P.indexOf('epubcfi(')&&')'===P[P.length-1]&&(P=P.slice(8,P.length-1)),L=this.getChapterComponent(P),!L)?{spinePos:-1}:(O.base=this.parseComponent(L),B=this.getPathComponent(P),O.path=this.parseComponent(B),z=this.getRange(P),z&&(O.range=!0,O.start=this.parseComponent(z[0]),O.end=this.parseComponent(z[1])),O.spinePos=O.base.steps[1].index,O):{spinePos:-1}}},{key:'parseComponent',value:function(P){var z,O={steps:[],terminal:{offset:null,assertion:null}},L=P.split(':'),B=L[0].split('/');return 1<L.length&&(z=L[1],O.terminal=this.parseTerminal(z)),''===B[0]&&B.shift(),O.steps=B.map(function(M){return this.parseStep(M)}.bind(this)),O}},{key:'parseStep',value:function(P){var O,L,B,z,M;if(z=P.match(/\[(.*)\]/),z&&z[1]&&(M=z[1]),L=parseInt(P),!isNaN(L))return 0==L%2?(O='element',B=L/2-1):(O='text',B=(L-1)/2),{type:O,index:B,id:M||null}}},{key:'parseTerminal',value:function(P){var O,L,B=P.match(/\[(.*)\]/);return B&&B[1]?(O=parseInt(P.split('[')[0])||null,L=B[1]):O=parseInt(P)||null,{offset:O,assertion:L}}},{key:'getChapterComponent',value:function(P){var O=P.split('!');return O[0]}},{key:'getPathComponent',value:function(P){var O=P.split('!');if(O[1]){var L=O[1].split(',');return L[0]}}},{key:'getRange',value:function(P){var O=P.split(',');return 3===O.length&&[O[1],O[2]]}},{key:'getCharecterOffsetComponent',value:function(P){var O=P.split(':');return O[1]||''}},{key:'joinSteps',value:function(P){return P?P.map(function(O){var L='';return'element'===O.type&&(L+=2*(O.index+1)),'text'===O.type&&(L+=1+2*O.index),O.id&&(L+='['+O.id+']'),L}).join('/'):''}},{key:'segmentString',value:function(P){var A='/';return A+=this.joinSteps(P.steps),P.terminal&&null!=P.terminal.offset&&(A+=':'+P.terminal.offset),P.terminal&&null!=P.terminal.assertion&&(A+='['+P.terminal.assertion+']'),A}},{key:'toString',value:function(){var P='epubcfi(';return P+=this.segmentString(this.base),P+='!',P+=this.segmentString(this.path),this.start&&(P+=',',P+=this.segmentString(this.start)),this.end&&(P+=',',P+=this.segmentString(this.end)),P+=')',P}},{key:'compare',value:function(P,O){var L,B,z,M;if('string'==typeof P&&(P=new N(P)),'string'==typeof O&&(O=new N(O)),P.spinePos>O.spinePos)return 1;if(P.spinePos<O.spinePos)return-1;P.range?(L=P.path.steps.concat(P.start.steps),z=P.start.terminal):(L=P.path.steps,z=P.path.terminal),O.range?(B=O.path.steps.concat(O.start.steps),M=O.start.terminal):(B=O.path.steps,M=O.path.terminal);for(var W=0;W<L.length;W++){if(!L[W])return-1;if(!B[W])return 1;if(L[W].index>B[W].index)return 1;if(L[W].index<B[W].index)return-1}return L.length<B.length?1:z.offset>M.offset?1:z.offset<M.offset?-1:0}},{key:'step',value:function(P){var O=P.nodeType===_?'text':'element';return{id:P.id,tagName:P.tagName,type:O,index:this.position(P)}}},{key:'filteredStep',value:function(P,O){var B,L=this.filter(P,O);if(L)return B=L.nodeType===_?'text':'element',{id:L.id,tagName:L.tagName,type:B,index:this.filteredPosition(L,O)}}},{key:'pathTo',value:function(P,O,L){for(var M,B={steps:[],terminal:{offset:null,assertion:null}},z=P;z&&z.parentNode&&z.parentNode.nodeType!=9;)M=L?this.filteredStep(z,L):this.step(z),M&&B.steps.unshift(M),z=z.parentNode;return null!=O&&0<=O&&(B.terminal.offset=O,'text'!=B.steps[B.steps.length-1].type&&B.steps.push({type:'text',index:0})),B}},{key:'equalStep',value:function(P,O){return P&&O&&P.index===O.index&&P.id===O.id&&P.type===O.type}},{key:'fromRange',value:function(P,O,L){var B={range:!1,base:{},path:{},start:null,end:null},z=P.startContainer,M=P.endContainer,W=P.startOffset,D=P.endOffset,U=!1;if(L&&(U=null!=z.ownerDocument.querySelector('.'+L)),'string'==typeof O?(B.base=this.parseComponent(O),B.spinePos=B.base.steps[1].index):'object'===('undefined'==typeof O?'undefined':k(O))&&(B.base=O),P.collapsed)U&&(W=this.patchOffset(z,W,L)),B.path=this.pathTo(z,W,L);else{B.range=!0,U&&(W=this.patchOffset(z,W,L)),B.start=this.pathTo(z,W,L),U&&(D=this.patchOffset(M,D,L)),B.end=this.pathTo(M,D,L),B.path={steps:[],terminal:null};var I,H=B.start.steps.length;for(I=0;I<H&&this.equalStep(B.start.steps[I],B.end.steps[I]);I++)I===H-1?B.start.terminal===B.end.terminal&&(B.path.steps.push(B.start.steps[I]),B.range=!1):B.path.steps.push(B.start.steps[I]);B.start.steps=B.start.steps.slice(B.path.steps.length),B.end.steps=B.end.steps.slice(B.path.steps.length)}return B}},{key:'fromNode',value:function(P,O,L){var B={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof O?(B.base=this.parseComponent(O),B.spinePos=B.base.steps[1].index):'object'===('undefined'==typeof O?'undefined':k(O))&&(B.base=O),B.path=this.pathTo(P,null,L),B}},{key:'filter',value:function(P,O){var L,B,z,M,W,D=!1;return P.nodeType===_?(D=!0,z=P.parentNode,L=P.parentNode.classList.contains(O)):(D=!1,L=P.classList.contains(O)),L&&D?(M=z.previousSibling,W=z.nextSibling,M&&M.nodeType===_?B=M:W&&W.nodeType===_&&(B=W),B?B:P):L&&!D?!1:P}},{key:'patchOffset',value:function(P,O,L){if(P.nodeType!=_)throw new Error('Anchor must be a text node');var B=P,z=O;for(P.parentNode.classList.contains(L)&&(B=P.parentNode);B.previousSibling;){if(B.previousSibling.nodeType!==S)z+=B.previousSibling.textContent.length;else if(B.previousSibling.classList.contains(L))z+=B.previousSibling.textContent.length;else break;B=B.previousSibling}return z}},{key:'normalizedMap',value:function(P,O,L){var M,D,U,B={},z=-1,W=P.length;for(M=0;M<W;M++)D=P[M].nodeType,D===S&&P[M].classList.contains(L)&&(D=_),0<M&&D===_&&U===_?B[M]=z:O===D&&(++z,B[M]=z),U=D;return B}},{key:'position',value:function(P){var O,L;return P.nodeType===S?(O=P.parentNode.children,!O&&(O=(0,E.findChildren)(P.parentNode)),L=Array.prototype.indexOf.call(O,P)):(O=this.textNodes(P.parentNode),L=O.indexOf(P)),L}},{key:'filteredPosition',value:function(P,O){var L,B,z;return P.nodeType===S?(L=P.parentNode.children,z=this.normalizedMap(L,S,O)):(L=P.parentNode.childNodes,P.parentNode.classList.contains(O)&&(P=P.parentNode,L=P.parentNode.childNodes),z=this.normalizedMap(L,_,O)),B=Array.prototype.indexOf.call(L,P),z[B]}},{key:'stepsToXpath',value:function(P){var O=['.','*'];return P.forEach(function(L){var B=L.index+1;L.id?O.push('*[position()='+B+' and @id=\''+L.id+'\']'):'text'===L.type?O.push('text()['+B+']'):O.push('*['+B+']')}),O.join('/')}},{key:'stepsToQuerySelector',value:function(P){var O=['html'];return P.forEach(function(L){var B=L.index+1;L.id?O.push('#'+L.id):'text'===L.type||O.push('*:nth-child('+B+')')}),O.join('>')}},{key:'textNodes',value:function(P,O){return Array.prototype.slice.call(P.childNodes).filter(function(L){return L.nodeType===_||O&&L.classList.contains(O)})}},{key:'walkToNode',value:function(P,O,L){var M,W,U,B=O||document,z=B.documentElement,D=P.length;for(U=0;U<D&&(W=P[U],'element'===W.type?W.id?z=B.getElementById(W.id):(M=z.children||(0,E.findChildren)(z),z=M[W.index]):'text'===W.type&&(z=this.textNodes(z,L)[W.index]),!!z);U++);return z}},{key:'findNode',value:function(P,O,L){var z,M,B=O||document;return L||'undefined'==typeof B.evaluate?L?z=this.walkToNode(P,B,L):z=this.walkToNode(P,B):(M=this.stepsToXpath(P),z=B.evaluate(M,B,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),z}},{key:'fixMiss',value:function(P,O,L,B){var D,U,z=this.findNode(P.slice(0,-1),L,B),M=z.childNodes,W=this.normalizedMap(M,_,B),H=P[P.length-1].index;for(var I in W){if(!W.hasOwnProperty(I))return;if(W[I]===H)if(D=M[I],U=D.textContent.length,O>U)O-=U;else{z=D.nodeType===S?D.childNodes[0]:D;break}}return{container:z,offset:O}}},{key:'toRange',value:function(P,O){var B,z,M,W,D,H,I,X,L=P||document,U=this,F=!!O&&null!=L.querySelector('.'+O);if(B='undefined'==typeof L.createRange?new E.RangeObject:L.createRange(),U.range?(z=U.start,H=U.path.steps.concat(z.steps),W=this.findNode(H,L,F?O:null),M=U.end,I=U.path.steps.concat(M.steps),D=this.findNode(I,L,F?O:null)):(z=U.path,H=U.path.steps,W=this.findNode(U.path.steps,L,F?O:null)),W)try{null==z.terminal.offset?B.setStart(W,0):B.setStart(W,z.terminal.offset)}catch(Y){X=this.fixMiss(H,z.terminal.offset,L,F?O:null),B.setStart(X.container,X.offset)}else return console.log('NO START'),null;if(D)try{null==M.terminal.offset?B.setEnd(D,0):B.setEnd(D,M.terminal.offset)}catch(Y){X=this.fixMiss(I,U.end.terminal.offset,L,F?O:null),B.setEnd(X.container,X.offset)}return B}},{key:'isCfiString',value:function(P){return'string'==typeof P&&0===P.indexOf('epubcfi(')&&')'===P[P.length-1]}},{key:'generateChapterComponent',value:function(P,O,L){var B=parseInt(O),M='/'+2*(P+1)+'/';return M+=2*(B+1),L&&(M+='['+L+']'),M}}]),N}();p.default=R,u.exports=p['default']},function(u){'use strict';function v(_){if('string'!=typeof _)throw new TypeError('Path must be a string. Received '+_)}function k(_,T){for(var P,R='',N=-1,A=0,O=0;O<=_.length;++O){if(O<_.length)P=_.charCodeAt(O);else if(47===P)break;else P=47;if(47===P){if(N==O-1||1==A);else if(N!=O-1&&2==A){if(2>R.length||46!==R.charCodeAt(R.length-1)||46!==R.charCodeAt(R.length-2))if(2<R.length){for(var L=R.length-1,B=L;0<=B&&47!==R.charCodeAt(B);--B);if(B!=L){R=-1==B?'':R.slice(0,B),N=O,A=0;continue}}else if(2===R.length||1===R.length){R='',N=O,A=0;continue}T&&(0<R.length?R+='/..':R='..')}else 0<R.length?R+='/'+_.slice(N+1,O):R=_.slice(N+1,O);N=O,A=0}else 46===P&&-1!=A?++A:A=-1}return R}function C(_,T){var R=T.dir||T.root,N=T.base||(T.name||'')+(T.ext||'');return R?R===T.root?R+N:R+_+N:N}if(!E)var E={cwd:function(){return'/'}};var S={resolve:function(){for(var N,T='',R=!1,A=arguments.length-1;-1<=A&&!R;A--){var P;(0<=A?P=arguments[A]:(void 0==N&&(N=E.cwd()),P=N),v(P),0!==P.length)&&(T=P+'/'+T,R=47===P.charCodeAt(0))}return T=k(T,!R),R?0<T.length?'/'+T:'/':0<T.length?T:'.'},normalize:function(T){if(v(T),0===T.length)return'.';var R=47===T.charCodeAt(0),N=47===T.charCodeAt(T.length-1);return T=k(T,!R),0!==T.length||R||(T='.'),0<T.length&&N&&(T+='/'),R?'/'+T:T},isAbsolute:function(T){return v(T),0<T.length&&47===T.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var T,N,R=0;R<arguments.length;++R)N=arguments[R],v(N),0<N.length&&(void 0==T?T=N:T+='/'+N);return void 0===T?'.':S.normalize(T)},relative:function(T,R){if(v(T),v(R),T===R)return'';if(T=S.resolve(T),R=S.resolve(R),T===R)return'';for(var N=1;N<T.length&&47===T.charCodeAt(N);++N);for(var A=T.length,P=A-N,O=1;O<R.length&&47===R.charCodeAt(O);++O);for(var L=R.length,B=L-O,z=P<B?P:B,M=-1,W=0;W<=z;++W){if(W==z){if(B>z){if(47===R.charCodeAt(O+W))return R.slice(O+W+1);if(0==W)return R.slice(O+W)}else P>z&&(47===T.charCodeAt(N+W)?M=W:0==W&&(M=0));break}var D=T.charCodeAt(N+W),U=R.charCodeAt(O+W);if(D!==U)break;else 47===D&&(M=W)}var H='';for(W=N+M+1;W<=A;++W)(W===A||47===T.charCodeAt(W))&&(H+=0===H.length?'..':'/..');return 0<H.length?H+R.slice(O+M):(O+=M,47===R.charCodeAt(O)&&++O,R.slice(O))},_makeLong:function(T){return T},dirname:function(T){if(v(T),0===T.length)return'.';for(var R=T.charCodeAt(0),N=47===R,A=-1,P=!0,O=T.length-1;1<=O;--O)if(R=T.charCodeAt(O),47!==R)P=!1;else if(!P){A=O;break}return-1===A?N?'/':'.':N&&1===A?'//':T.slice(0,A)},basename:function(T,R){if(R!==void 0&&'string'!=typeof R)throw new TypeError('"ext" argument must be a string');v(T);var N=0,A=-1,P=!0,O;if(void 0!==R&&0<R.length&&R.length<=T.length){if(R.length===T.length&&R===T)return'';var L=R.length-1,B=-1;for(O=T.length-1;0<=O;--O){var z=T.charCodeAt(O);if(47!==z)-1==B&&(P=!1,B=O+1),0<=L&&(z===R.charCodeAt(L)?-1==--L&&(A=O):(L=-1,A=B));else if(!P){N=O+1;break}}return N===A?A=B:-1===A&&(A=T.length),T.slice(N,A)}for(O=T.length-1;0<=O;--O)if(47!==T.charCodeAt(O))-1==A&&(P=!1,A=O+1);else if(!P){N=O+1;break}return-1===A?'':T.slice(N,A)},extname:function(T){v(T);for(var B,R=-1,N=0,A=-1,P=!0,O=0,L=T.length-1;0<=L;--L){if(B=T.charCodeAt(L),47===B){if(!P){N=L+1;break}continue}-1==A&&(P=!1,A=L+1),46===B?-1==R?R=L:1!=O&&(O=1):-1!==R&&(O=-1)}return-1===R||-1===A||0==O||1==O&&R===A-1&&R===N+1?'':T.slice(R,A)},format:function(T){if(null===T||'object'!=typeof T)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof T);return C('/',T)},parse:function(T){v(T);var R={root:'',dir:'',base:'',ext:'',name:''};if(0===T.length)return R;var P,N=T.charCodeAt(0),A=47===N;A?(R.root='/',P=1):P=0;for(var O=-1,L=0,B=-1,z=!0,M=T.length-1,W=0;M>=P;--M){if(N=T.charCodeAt(M),47===N){if(!z){L=M+1;break}continue}-1==B&&(z=!1,B=M+1),46===N?-1==O?O=M:1!=W&&(W=1):-1!=O&&(W=-1)}return-1==O||-1==B||0==W||1==W&&O==B-1&&O==L+1?-1!=B&&(0==L&&A?R.base=R.name=T.slice(1,B):R.base=R.name=T.slice(L,B)):(0==L&&A?(R.name=T.slice(1,O),R.base=T.slice(1,B)):(R.name=T.slice(L,O),R.base=T.slice(L,B)),R.ext=T.slice(O,B)),0<L?R.dir=T.slice(0,L-1):A&&(R.dir='/'),R},sep:'/',delimiter:':',posix:null};u.exports=S},function(u,p,f){'use strict';function v(M){return M&&M.__esModule?M:{default:M}}function k(M,W){if(!(M instanceof W))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var C=function(){function M(W,D){var U=[],H=!0,I=!1,F;try{for(var Y,X=W[Symbol.iterator]();!(H=(Y=X.next()).done)&&(U.push(Y.value),!(D&&U.length===D));H=!0);}catch(K){I=!0,F=K}finally{try{!H&&X['return']&&X['return']()}finally{if(I)throw F}}return U}return function(W,D){if(Array.isArray(W))return W;if(Symbol.iterator in Object(W))return M(W,D);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),E=function(){function M(W,D){for(var H,U=0;U<D.length;U++)H=D[U],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(W,H.key,H)}return function(W,D,U){return D&&M(W.prototype,D),U&&M(W,U),W}}(),S=f(23),_=v(S),T=f(0),R=f(1),N=v(R),A=f(6),P=v(A),O=f(8),L=f(25),B=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],z=function(){function M(W,D,U){k(this,M),this.epubcfi=new N.default,this.document=W,this.documentElement=this.document.documentElement,this.content=D||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.cfiBase=U||'',this.pane=void 0,this.listeners()}return E(M,[{key:'width',value:function(D){var U=this.content;return D&&(0,T.isNumber)(D)&&(D+='px'),D&&(U.style.width=D),this.window.getComputedStyle(U).width}},{key:'height',value:function(D){var U=this.content;return D&&(0,T.isNumber)(D)&&(D+='px'),D&&(U.style.height=D),this.window.getComputedStyle(U).height}},{key:'contentWidth',value:function(D){var U=this.content||this.document.body;return D&&(0,T.isNumber)(D)&&(D+='px'),D&&(U.style.width=D),this.window.getComputedStyle(U).width}},{key:'contentHeight',value:function(D){var U=this.content||this.document.body;return D&&(0,T.isNumber)(D)&&(D+='px'),D&&(U.style.height=D),this.window.getComputedStyle(U).height}},{key:'textWidth',value:function(){var D,U=this.document.createRange(),H=this.content||this.document.body;return U.selectNodeContents(H),D=U.getBoundingClientRect().width,D}},{key:'textHeight',value:function(){var D,U=this.document.createRange(),H=this.content||this.document.body;return U.selectNodeContents(H),D=U.getBoundingClientRect().height,D}},{key:'scrollWidth',value:function(){var D=this.documentElement.scrollWidth;return D}},{key:'scrollHeight',value:function(){var D=this.documentElement.scrollHeight;return D}},{key:'overflow',value:function(D){return D&&(this.documentElement.style.overflow=D),this.window.getComputedStyle(this.documentElement).overflow}},{key:'overflowX',value:function(D){return D&&(this.documentElement.style.overflowX=D),this.window.getComputedStyle(this.documentElement).overflowX}},{key:'overflowY',value:function(D){return D&&(this.documentElement.style.overflowY=D),this.window.getComputedStyle(this.documentElement).overflowY}},{key:'css',value:function(D,U,H){var I=this.content||this.document.body;return U&&I.style.setProperty(D,U,H?'important':''),this.window.getComputedStyle(I)[D]}},{key:'viewport',value:function(D){var K,V,J,Q,G,Z,$=this.document.querySelector('meta[name=\'viewport\']'),ee='';if($&&$.hasAttribute('content')){var te=$.getAttribute('content'),ne=te.match(/width\s*=\s*([^,]*)/g),ae=te.match(/height\s*=\s*([^,]*)/g),ie=te.match(/initial-scale\s*=\s*([^,]*)/g),le=te.match(/minimum-scale\s*=\s*([^,]*)/g),oe=te.match(/maximum-scale\s*=\s*([^,]*)/g),re=te.match(/user-scalable\s*=\s*([^,]*)/g);ne[1]&&(K=ne[1]),ae[1]&&(V=ae[1]),ie[1]&&(J=ie[1]),le[1]&&(Q=le[1]),oe[1]&&(G=oe[1]),re[1]&&(Z=re[1])}return D&&(ee+='width='+(D.width||K),ee+=', height='+(D.height||V),(D.scale||J)&&(ee+=', initial-scale='+(D.scale||J)),(D.scalable||Z)&&(ee+=', minimum-scale='+(D.scale||Q),ee+=', maximum-scale='+(D.scale||G),ee+=', user-scalable='+(D.scalable||Z)),!$&&($=this.document.createElement('meta'),$.setAttribute('name','viewport'),this.document.querySelector('head').appendChild($)),$.setAttribute('content',ee)),{width:parseInt(K),height:parseInt(V)}}},{key:'expand',value:function(){this.emit('expand')}},{key:'listeners',value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:'removeListeners',value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:'resizeListeners',value:function(){var D,U;clearTimeout(this.expanding),D=this.scrollWidth(),U=this.scrollHeight(),(D!=this._size.width||U!=this._size.height)&&(this._size={width:D,height:U},this.pane&&this.pane.render(),this.emit('resize',this._size)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:'mediaQueryListeners',value:function(){for(var D=this.document.styleSheets,U=function(Y){Y.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),H=0;H<D.length;H+=1){var I;try{I=D[H].cssRules}catch(Y){return}if(!I)return;for(var F=0;F<I.length;F+=1)if(I[F].media){var X=this.window.matchMedia(I[F].media.mediaText);X.addListener(U)}}}},{key:'observe',value:function(D){var U=this,H=new MutationObserver(function(){U._expanding&&U.expand()});return H.observe(D,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),H}},{key:'imageLoadListeners',value:function(){for(var H,U=this.document.querySelectorAll('img'),I=0;I<U.length;I++)H=U[I],'undefined'!=typeof H.naturalWidth&&0===H.naturalWidth&&(H.onload=this.expand.bind(this))}},{key:'fontLoadListeners',value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.expand()}.bind(this))}},{key:'root',value:function(){return this.document?this.document.documentElement:null}},{key:'locationOf',value:function(D,U){var H,I={left:0,top:0};if(this.document){if(this.epubcfi.isCfiString(D)){var F=new N.default(D).toRange(this.document,U);F&&(F.startContainer.nodeType===Node.ELEMENT_NODE?(H=F.startContainer.getBoundingClientRect(),I.left=H.left,I.top=H.top):F.collapsed?H=F.getClientRects()[0]:H=F.getBoundingClientRect())}else if('string'==typeof D&&-1<D.indexOf('#')){var X=D.substring(D.indexOf('#')+1),Y=this.document.getElementById(X);Y&&(H=Y.getBoundingClientRect())}return H&&(I.left=H.left,I.top=H.top),I}}},{key:'addStylesheet',value:function(D){return new Promise(function(U){var I,F=!1;return this.document?(I=this.document.querySelector('link[href=\''+D+'\']'),I?void U(!0):void(I=this.document.createElement('link'),I.type='text/css',I.rel='stylesheet',I.href=D,I.onload=I.onreadystatechange=function(){var X=this;F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){X.pane&&X.pane.render(),U(!0)},1))},this.document.head.appendChild(I))):void U(!1)}.bind(this))}},{key:'addStylesheetRules',value:function(D){var U,H,I='epubjs-inserted-css';if(this.document&&D&&0!==D.length){if(U=this.document.getElementById('#'+I),U||(U=this.document.createElement('style'),U.id=I),this.document.head.appendChild(U),H=U.sheet,'[object Array]'===Object.prototype.toString.call(D))for(var F=0,X=D.length;F<X;F++){var Y=1,K=D[F],V=D[F][0],J='';'[object Array]'===Object.prototype.toString.call(K[1][0])&&(K=K[1],Y=0);for(var G,Q=K.length;Y<Q;Y++)G=K[Y],J+=G[0]+':'+G[1]+(G[2]?' !important':'')+';\n';H.insertRule(V+'{'+J+'}',H.cssRules.length)}else{var Z=Object.keys(D);Z.forEach(function($){var ee=D[$],te=Object.keys(ee),ne=te.map(function(ae){return ae+':'+ee[ae]}).join(';');H.insertRule($+'{'+ne+'}',H.cssRules.length)})}this.pane&&this.pane.render()}}},{key:'addScript',value:function(D){return new Promise(function(U){var I,F=!1;return this.document?void(I=this.document.createElement('script'),I.type='text/javascript',I.async=!0,I.src=D,I.onload=I.onreadystatechange=function(){F||this.readyState&&'complete'!=this.readyState||(F=!0,setTimeout(function(){U(!0)},1))},this.document.head.appendChild(I)):void U(!1)}.bind(this))}},{key:'addClass',value:function(D){var U;this.document&&(U=this.content||this.document.body,U.classList.add(D))}},{key:'removeClass',value:function(D){var U;this.document&&(U=this.content||this.document.body,U.classList.remove(D))}},{key:'addEventListeners',value:function(){this.document&&B.forEach(function(D){this.document.addEventListener(D,this.triggerEvent.bind(this),!1)},this)}},{key:'removeEventListeners',value:function(){this.document&&B.forEach(function(D){this.document.removeEventListener(D,this.triggerEvent,!1)},this)}},{key:'triggerEvent',value:function(D){this.emit(D.type,D)}},{key:'addSelectionListeners',value:function(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}},{key:'removeSelectionListeners',value:function(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}},{key:'onSelectionChange',value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var U=this.window.getSelection();this.triggerSelectedEvent(U)}.bind(this),250)}},{key:'triggerSelectedEvent',value:function(D){var U,H;D&&0<D.rangeCount&&(U=D.getRangeAt(0),!U.collapsed&&(H=new N.default(U,this.cfiBase).toString(),this.emit('selected',H),this.emit('selectedRange',U)))}},{key:'range',value:function(D,U){var H=new N.default(D);return H.toRange(this.document,U)}},{key:'cfiFromRange',value:function(D,U){return new N.default(D,this.cfiBase,U).toString()}},{key:'cfiFromNode',value:function(D,U){return new N.default(D,this.cfiBase,U).toString()}},{key:'map',value:function(D){var W=new P.default(D);return W.section()}},{key:'size',value:function(D,U){0<=D&&this.width(D),0<=U&&this.height(U),this.css('margin','0'),this.css('box-sizing','border-box')}},{key:'columns',value:function(D,U,H,I){var F=(0,T.prefixed)('column-axis'),X=(0,T.prefixed)('column-gap'),Y=(0,T.prefixed)('column-width'),K=(0,T.prefixed)('column-fill');this.width(D),this.height(U),this.viewport({width:D,height:U,scale:1,scalable:'no'}),this.css('overflow-y','hidden'),this.css('margin','0',!0),this.css('padding','0',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(F,'horizontal'),this.css(K,'auto'),this.css(X,I+'px'),this.css(Y,H+'px')}},{key:'scaler',value:function(D,U,H){var F='';this.css('transform-origin','top left'),(0<=U||0<=H)&&(F=' translate('+(U||0)+'px, '+(H||0)+'px )'),this.css('transform','scale('+D+')'+F)}},{key:'fit',value:function(D,U){var H=this.viewport(),I=D/H.width,F=U/H.height,X=I<F?I:F,Y=(U-H.height*X)/2;this.width(D),this.height(U),this.overflow('hidden'),this.viewport({scale:1}),this.scaler(X,0,Y),this.css('background-color','transparent')}},{key:'mapPage',value:function(D,U,H,I,F){var X=new P.default(U,F);return X.page(this,D,H,I)}},{key:'linksHandler',value:function(){var D=this;(0,O.replaceLinks)(this.content,function(U){D.emit('link',U)})}},{key:'highlight',value:function(D){var U=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},H=arguments[2],I=this.range(D);U.epubcfi=D,this.pane||(this.pane=new L.Pane(this.content,this.document.body));var F=new L.Highlight(I,'epubjs-hl',U,{fill:'yellow','fill-opacity':'0.3','mix-blend-mode':'multiply'}),X=this.pane.addMark(F);return H&&X.element.addEventListener('click',H),X}},{key:'underline',value:function(D){var U=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},H=arguments[2],I=this.range(D);U.epubcfi=D,this.pane||(this.pane=new L.Pane(this.content,this.document.body));var F=new L.Underline(I,'epubjs-ul',U,{stroke:'black','stroke-opacity':'0.3','mix-blend-mode':'multiply'}),X=this.pane.addMark(F);return H&&X.element.addEventListener('click',H),X}},{key:'mark',value:function(D){var U=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},H=arguments[2],I=this.range(D),F=I.commonAncestorContainer,X=1===F.nodeType?F:F.parentNode;X.setAttribute('ref','epubjs-mk'),X.dataset.epubcfi=D,U&&Object.entries(U).forEach(function(Y){var K=C(Y,2),V=K[0],J=K[1];X.dataset[V]=J}),H&&X.addEventListener('click',H)}},{key:'destroy',value:function(){this.observer&&this.observer.disconnect(),this.removeListeners()}}],[{key:'listenedEvents',get:function(){return B}}]),M}();(0,_.default)(z.prototype),p.default=z,u.exports=p['default']},function(u,p,f){var v=f(3);u.exports=v},function(u,p,f){'use strict';var S,v=f(10),k=f(17),C=f(13),E=f(20);S=u.exports=function(_,T){var R,N,A,P,O;return 2>arguments.length||'string'!=typeof _?(P=T,T=_,_=null):P=arguments[2],null==_?(R=A=!0,N=!1):(R=E.call(_,'c'),N=E.call(_,'e'),A=E.call(_,'w')),O={value:T,configurable:R,enumerable:N,writable:A},P?v(k(P),O):O},S.gs=function(_,T,R){var N,A,P,O;return'string'==typeof _?P=arguments[3]:(P=R,R=T,T=_,_=null),null==T?T=void 0:C(T)?null==R?R=void 0:!C(R)&&(P=R,R=void 0):(P=T,T=R=void 0),null==_?(N=!0,A=!1):(N=E.call(_,'c'),A=E.call(_,'e')),O={get:T,set:R,configurable:N,enumerable:A},P?v(k(P),O):O}},function(u,p,f){'use strict';function k(T,R){if(!(T instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var C=function(){function T(R,N){for(var P,A=0;A<N.length;A++)P=N[A],P.enumerable=P.enumerable||!1,P.configurable=!0,'value'in P&&(P.writable=!0),Object.defineProperty(R,P.key,P)}return function(R,N,A){return N&&T(R.prototype,N),A&&T(R,A),R}}(),E=f(1),S=function(T){return T&&T.__esModule?T:{default:T}}(E),_=function(){function T(R,N){k(this,T),this.layout=R,this.horizontal='paginated'===this.layout.flow,this._dev=N}return C(T,[{key:'section',value:function(N){var A=this.findRanges(N),P=this.rangeListToCfiList(N.section.cfiBase,A);return P}},{key:'page',value:function(N,A,P,O){var B,L=N&&N.document&&N.document.body;if(L){if(B=this.rangePairToCfiPair(A,{start:this.findStart(L,P,O),end:this.findEnd(L,P,O)}),!0===this._dev){var z=N.document,M=new S.default(B.start).toRange(z),W=new S.default(B.end).toRange(z),D=z.defaultView.getSelection(),U=z.createRange();D.removeAllRanges(),U.setStart(M.startContainer,M.startOffset),U.setEnd(W.endContainer,W.endOffset),D.addRange(U)}return B}}},{key:'walk',value:function(N,A){for(var O,L,P=document.createTreeWalker(N,NodeFilter.SHOW_TEXT,{acceptNode:function(z){return 0<z.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},!1);(O=P.nextNode())&&(L=A(O),!L););return L}},{key:'findRanges',value:function(N){for(var M,W,A=[],P=N.contents.scrollWidth(),O=Math.ceil(P/this.layout.spreadWidth),L=O*this.layout.divisor,B=this.layout.columnWidth,z=this.layout.gap,D=0;D<L.pages;D++)M=(B+z)*D,W=B*(D+1)+z*D,A.push({start:this.findStart(N.document.body,M,W),end:this.findEnd(N.document.body,M,W)});return A}},{key:'findStart',value:function(N,A,P){for(var B,z,O=this,L=[N],M=N;L.length;)if(B=L.shift(),z=this.walk(B,function(W){var D,U,H,I;return(W.nodeType==Node.TEXT_NODE?(I=document.createRange(),I.selectNodeContents(W),H=I.getBoundingClientRect()):H=W.getBoundingClientRect(),D=O.horizontal?H.left:H.top,U=O.horizontal?H.right:H.bottom,D>=A&&D<=P)?W:U>A?W:void(M=W,L.push(W))}),z)return this.findTextStartRange(z,A,P);return this.findTextStartRange(M,A,P)}},{key:'findEnd',value:function(N,A,P){for(var B,M,O=this,L=[N],z=N;L.length;)if(B=L.shift(),M=this.walk(B,function(W){var D,U,H,I;return(W.nodeType==Node.TEXT_NODE?(I=document.createRange(),I.selectNodeContents(W),H=I.getBoundingClientRect()):H=W.getBoundingClientRect(),D=O.horizontal?H.left:H.top,U=O.horizontal?H.right:H.bottom,D>P&&z)?z:U>P?W:void(z=W,L.push(W))}),M)return this.findTextEndRange(M,A,P);return this.findTextEndRange(z,A,P)}},{key:'findTextStartRange',value:function(N,A){for(var L,B,z,O=this.splitTextNodeIntoRanges(N),M=0;M<O.length;M++)if(L=O[M],B=L.getBoundingClientRect(),z=this.horizontal?B.left:B.top,z>=A)return L;return O[0]}},{key:'findTextEndRange',value:function(N,A,P){for(var L,B,z,M,W,O=this.splitTextNodeIntoRanges(N),D=0;D<O.length;D++){if(B=O[D],z=B.getBoundingClientRect(),M=this.horizontal?z.left:z.top,W=this.horizontal?z.right:z.bottom,M>P&&L)return L;if(W>P)return B;L=B}return O[O.length-1]}},{key:'splitTextNodeIntoRanges',value:function(N,A){var B,P=[],O=N.textContent||'',L=O.trim(),z=N.ownerDocument,M=A||' ',W=L.indexOf(M);if(-1===W||N.nodeType!=Node.TEXT_NODE)return B=z.createRange(),B.selectNodeContents(N),[B];for(B=z.createRange(),B.setStart(N,0),B.setEnd(N,W),P.push(B),B=!1;-1!=W;)W=L.indexOf(M,W+1),0<W&&(B&&(B.setEnd(N,W),P.push(B)),B=z.createRange(),B.setStart(N,W+1));return B&&(B.setEnd(N,L.length),P.push(B)),P}},{key:'rangePairToCfiPair',value:function(N,A){var P=A.start,O=A.end;P.collapse(!0),O.collapse(!1);var L=new S.default(P,N).toString(),B=new S.default(O,N).toString();return{start:L,end:B}}},{key:'rangeListToCfiList',value:function(N,A){for(var O,P=[],L=0;L<A.length;L++)O=this.rangePairToCfiPair(N,A[L]),P.push(O);return P}}]),T}();p.default=_,u.exports=p['default']},function(u,p,f){'use strict';function k(T,R){if(!(T instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var C=function(){function T(R,N){for(var P,A=0;A<N.length;A++)P=N[A],P.enumerable=P.enumerable||!1,P.configurable=!0,'value'in P&&(P.writable=!0),Object.defineProperty(R,P.key,P)}return function(R,N,A){return N&&T(R.prototype,N),A&&T(R,A),R}}(),E=f(2),S=function(T){return T&&T.__esModule?T:{default:T}}(E),_=function(){function T(R){k(this,T);var N,A;N=R.indexOf('://'),-1<N&&(R=new URL(R).pathname),A=this.parse(R),this.path=R,this.directory=this.isDirectory(R)?R:A.dir+'/',this.filename=A.base,this.extension=A.ext.slice(1)}return C(T,[{key:'parse',value:function(N){return S.default.parse(N)}},{key:'isAbsolute',value:function(N){return S.default.isAbsolute(N||this.path)}},{key:'isDirectory',value:function(N){return'/'===N.charAt(N.length-1)}},{key:'resolve',value:function(N){return S.default.resolve(this.directory,N)}},{key:'relative',value:function(N){return S.default.relative(this.directory,N)}},{key:'splitPath',value:function(N){return this.splitPathRe.exec(N).slice(1)}},{key:'toString',value:function(){return this.path}}]),T}();p.default=_,u.exports=p['default']},function(u,p,f){'use strict';Object.defineProperty(p,'__esModule',{value:!0}),p.replaceBase=function(N,A){var P,O;N&&(O=(0,_.qs)(N,'head'),P=(0,_.qs)(O,'base'),!P&&(P=N.createElement('base'),O.insertBefore(P,O.firstChild)),P.setAttribute('href',A.url))},p.replaceCanonical=function(N,A){var P,O,L=A.url;N&&(P=(0,_.qs)(N,'head'),O=(0,_.qs)(P,'link[rel=\'canonical\']'),O?O.setAttribute('href',L):(O=N.createElement('link'),O.setAttribute('rel','canonical'),O.setAttribute('href',L),P.appendChild(O)))},p.replaceLinks=function(N,A){for(var P=N.querySelectorAll('a[href]'),O=(0,_.qs)(N.ownerDocument,'base'),L=O?O.href:void 0,B=function(M){var W=M.getAttribute('href');if(0!==W.indexOf('mailto:')){var D=-1<W.indexOf('://'),U=new R.default(W,L);D?M.setAttribute('target','_blank'):M.onclick=function(){return U&&U.hash?A(U.Path.path+U.hash):U?A(U.Path.path):A(W),!1}}}.bind(this),z=0;z<P.length;z++)B(P[z])},p.substitute=function(N,A,P){return A.forEach(function(O,L){O&&P[L]&&(N=N.replace(new RegExp(O,'g'),P[L]))}),N};var _=f(0),T=f(9),R=function(N){return N&&N.__esModule?N:{default:N}}(T)},function(u,p,f){'use strict';function v(N){return N&&N.__esModule?N:{default:N}}function k(N,A){if(!(N instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(p,'__esModule',{value:!0});var C=function(){function N(A,P){for(var L,O=0;O<P.length;O++)L=P[O],L.enumerable=L.enumerable||!1,L.configurable=!0,'value'in L&&(L.writable=!0),Object.defineProperty(A,L.key,L)}return function(A,P,O){return P&&N(A.prototype,P),O&&N(A,O),A}}(),E=f(7),S=v(E),_=f(2),T=v(_),R=function(){function N(A,P){k(this,N);var O=-1<A.indexOf('://'),L=A;if(this.Url=void 0,this.href=A,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=P,!O&&!1!==P&&'string'!=typeof P&&window&&window.location&&(this.base=window.location.href),O||this.base)try{this.Url=this.base?new URL(A,this.base):new URL(A),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,L=this.Url.pathname}catch(B){this.Url=void 0}this.Path=new S.default(L),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return C(N,[{key:'path',value:function(){return this.Path}},{key:'resolve',value:function(P){var L,O=-1<P.indexOf('://');return O?P:(L=T.default.resolve(this.directory,P),this.origin+L)}},{key:'relative',value:function(P){return T.default.relative(P,this.directory)}},{key:'toString',value:function(){return this.href}}]),N}();p.default=R,u.exports=p['default']},function(u,p,f){'use strict';u.exports=f(11)()?Object.assign:f(12)},function(u){'use strict';u.exports=function(){var k,v=Object.assign;return!('function'!=typeof v)&&(k={foo:'raz'},v(k,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===k.foo+k.bar+k.trzy)}},function(u,p,f){'use strict';var v=f(14),k=f(19);u.exports=function(E,S){var _,T,N,R=_Mathmax(arguments.length,2);for(E=Object(k(E)),N=function(A){try{E[A]=S[A]}catch(P){_||(_=P)}},T=1;T<R;++T)S=arguments[T],v(S).forEach(N);if(_!==void 0)throw _;return E}},function(u){'use strict';u.exports=function(v){return'function'==typeof v}},function(u,p,f){'use strict';u.exports=f(15)()?Object.keys:f(16)},function(u){'use strict';u.exports=function(){try{return Object.keys('primitive'),!0}catch(v){return!1}}},function(u){'use strict';var v=Object.keys;u.exports=function(k){return v(null==k?k:Object(k))}},function(u){'use strict';var v=Array.prototype.forEach,k=Object.create,C=function(E,S){for(var _ in E)S[_]=E[_]};u.exports=function(){var S=k(null);return v.call(arguments,function(_){null==_||C(Object(_),S)}),S}},function(u){'use strict';u.exports=function(v){if('function'!=typeof v)throw new TypeError(v+' is not a function');return v}},function(u){'use strict';u.exports=function(v){if(null==v)throw new TypeError('Cannot use null or undefined');return v}},function(u,p,f){'use strict';u.exports=f(21)()?_Stringprototype.contains:f(22)},function(u){'use strict';var v='razdwatrzy';u.exports=function(){return!('function'!=typeof v.contains)&&!0===v.contains('dwa')&&!1===v.contains('foo')}},function(u){'use strict';var v=_Stringprototype.indexOf;u.exports=function(k){return-1<v.call(this,k,arguments[1])}},function(u,p,f){'use strict';var A,P,O,L,B,z,M,v=f(5),k=f(18),C=Function.prototype.apply,E=Function.prototype.call,S=Object.create,_=Object.defineProperty,T=Object.defineProperties,R=Object.prototype.hasOwnProperty,N={configurable:!0,enumerable:!1,writable:!0};A=function(W,D){var U;return k(D),R.call(this,'__ee__')?U=this.__ee__:(U=N.value=S(null),_(this,'__ee__',N),N.value=null),U[W]?'object'==typeof U[W]?U[W].push(D):U[W]=[U[W],D]:U[W]=D,this},P=function(W,D){var U,H;return k(D),H=this,A.call(this,W,U=function(){O.call(H,W,U),C.call(D,this,arguments)}),U.__eeOnceListener__=D,this},O=function(W,D){var U,H,I,F;if(k(D),!R.call(this,'__ee__'))return this;if(U=this.__ee__,!U[W])return this;if(H=U[W],'object'==typeof H)for(F=0;I=H[F];++F)(I===D||I.__eeOnceListener__===D)&&(2===H.length?U[W]=H[F?0:1]:H.splice(F,1));else(H===D||H.__eeOnceListener__===D)&&delete U[W];return this},L=function(W){var D,U,H,I,F;if(R.call(this,'__ee__')&&(I=this.__ee__[W],!!I))if('object'==typeof I){for(U=arguments.length,F=Array(U-1),D=1;D<U;++D)F[D-1]=arguments[D];for(I=I.slice(),D=0;H=I[D];++D)C.call(H,this,F)}else switch(arguments.length){case 1:E.call(I,this);break;case 2:E.call(I,this,arguments[1]);break;case 3:E.call(I,this,arguments[1],arguments[2]);break;default:for(U=arguments.length,F=Array(U-1),D=1;D<U;++D)F[D-1]=arguments[D];C.call(I,this,F);}},B={on:A,once:P,off:O,emit:L},z={on:v(A),once:v(P),off:v(O),emit:v(L)},M=T({},z),u.exports=p=function(W){return null==W?S(M):T(Object(W),z)},p.methods=B},function(u,p){'use strict';function k(E){var S=Object.assign({},E,{bubbles:!1});try{return new MouseEvent(E.type,S)}catch(T){var _=document.createEvent('MouseEvents');return _.initMouseEvent(E.type,!1,S.cancelable,S.view,S.detail,S.screenX,S.screenY,S.clientX,S.clientY,S.ctrlKey,S.altKey,S.shiftKey,S.metaKey,S.button,S.relatedTarget),_}}function C(E,S,_){function T(O,L,B){var z=O.top+O.height,M=O.left+O.width;return O.top<=B&&O.left<=L&&z>B&&M>L}var R=E.getBoundingClientRect();if(!T(R,S,_))return!1;for(var N=E.getClientRects(),A=0,P=N.length;A<P;A++)if(T(N[A],S,_))return!0;return!1}p.a={proxyMouse:function(E,S){function _(R){for(var A,N=S.length-1;0<=N;N--)if(A=S[N],!!C(A,R.clientX,R.clientY)){A.dispatchEvent(k(R));break}}for(var T of['mouseup','mousedown','click'])E.addEventListener(T,(R)=>_(R),!1)}}},function(u,p,f){'use strict';function v(A){var P=A.getBoundingClientRect();return{top:P.top+A.ownerDocument.body.scrollTop,left:P.left+A.ownerDocument.body.scrollLeft,height:P.height+A.scrollHeight,width:P.width+A.scrollWidth}}function k(A,P){A.style.top=`${P.top}px`,A.style.left=`${P.left}px`,A.style.height=`${P.height}px`,A.style.width=`${P.width}px`}function C(A,P){return P.right<=A.right&&P.left>=A.left&&P.top>=A.top&&P.bottom<=A.bottom}Object.defineProperty(p,'__esModule',{value:!0});var E=f(26),S=f(24);p.Pane=class{constructor(A,P=document.body){this.target=A,this.element=E.a.createElement('svg'),this.marks=[],this.element.style.position='absolute',this.element.setAttribute('pointer-events','none'),S.a.proxyMouse(this.target,this.marks),P.appendChild(this.element),this.render()}addMark(A){var P=E.a.createElement('g');return this.element.appendChild(P),A.bind(P),this.marks.push(A),A.render(),A}removeMark(A){var P=this.marks.indexOf(A);if(-1!==P){var O=A.unbind();this.element.removeChild(O),this.marks.splice(P,1)}}render(){k(this.element,v(this.target));for(var A of this.marks)A.render()}};class T{constructor(){this.element=null}bind(A){this.element=A}unbind(){var A=this.element;return this.element=null,A}render(){}dispatchEvent(A){this.element&&this.element.dispatchEvent(A)}getBoundingClientRect(){return this.element.getBoundingClientRect()}getClientRects(){for(var A=[],P=this.element.firstChild;P;)A.push(P.getBoundingClientRect()),P=P.nextSibling;return A}filteredRanges(){var A=Array.from(this.range.getClientRects());return A.filter((P)=>{for(var O=0;O<A.length;O++){if(A[O]===P)return!0;let L=C(A[O],P);if(L)return!1}return!0})}}p.Mark=T;class R extends T{constructor(A,P,O,L){super(),this.range=A,this.className=P,this.data=O||{},this.attributes=L||{}}bind(A){for(var P in super.bind(A),this.data)this.data.hasOwnProperty(P)&&(this.element.dataset[P]=this.data[P]);for(var P in this.attributes)this.attributes.hasOwnProperty(P)&&this.element.setAttribute(P,this.attributes[P]);this.className&&this.element.classList.add(this.className)}render(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var A=this.element.ownerDocument.createDocumentFragment(),P=this.filteredRanges(),O=this.element.getBoundingClientRect(),L=0,B=P.length;L<B;L++){var z=P[L],M=E.a.createElement('rect');M.setAttribute('x',z.left-O.left),M.setAttribute('y',z.top-O.top),M.setAttribute('height',z.height),M.setAttribute('width',z.width),A.appendChild(M)}this.element.appendChild(A)}}p.Highlight=R;p.Underline=class extends R{constructor(A,P,O,L){super(A,P,O,L)}render(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var A=this.element.ownerDocument.createDocumentFragment(),P=this.filteredRanges(),O=this.element.getBoundingClientRect(),L=0,B=P.length;L<B;L++){var z=P[L],M=E.a.createElement('rect');M.setAttribute('x',z.left-O.left),M.setAttribute('y',z.top-O.top),M.setAttribute('height',z.height),M.setAttribute('width',z.width),M.setAttribute('fill','none');var W=E.a.createElement('line');W.setAttribute('x1',z.left-O.left),W.setAttribute('x2',z.left-O.left+z.width),W.setAttribute('y1',z.top-O.top+z.height-1),W.setAttribute('y2',z.top-O.top+z.height-1),W.setAttribute('stroke-width',1),W.setAttribute('stroke','black'),W.setAttribute('stroke-linecap','square'),A.appendChild(M),A.appendChild(W)}this.element.appendChild(A)}}},function(u,p){'use strict';p.a={createElement:function(k){return document.createElementNS('http://www.w3.org/2000/svg',k)}}},function(u){u.exports=s}])});